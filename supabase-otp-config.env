# =================================================================
# SUPABASE OTP CONFIGURATION FOR FLEXWISE
# =================================================================
# This file configures both Email OTP (via Brevo) and SMS OTP (via Twilio)

# =================================================================
# üìß EMAIL OTP CONFIGURATION (Using Brevo SMTP)
# =================================================================

# Brevo SMTP settings for OTP emails
GOTRUE_SMTP_HOST="smtp-relay.brevo.com"
GOTRUE_SMTP_PORT="587"
GOTRUE_SMTP_USER="YOUR_BREVO_SMTP_LOGIN"
GOTRUE_SMTP_PASS="YOUR_BREVO_SMTP_KEY"
GOTRUE_SMTP_ADMIN_EMAIL="admin@flexwise-schule.de"
GOTRUE_SMTP_SENDER_NAME="FlexWise Schulplattform"
GOTRUE_SMTP_MAX_FREQUENCY="5s"

# Email OTP template configuration
GOTRUE_MAILER_SUBJECTS_RECOVERY="Passwort zur√ºcksetzen - FlexWise"
GOTRUE_MAILER_SUBJECTS_CONFIRMATION="E-Mail best√§tigen - FlexWise"
GOTRUE_MAILER_SUBJECTS_MAGIC_LINK="Ihr Anmelde-Code - FlexWise"

# Custom OTP email template (German)
GOTRUE_MAILER_TEMPLATES_MAGIC_LINK='<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ihr Anmelde-Code - FlexWise</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;">
    <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f5f5f5; padding: 20px 0;">
        <tr>
            <td align="center">
                <table width="600" cellpadding="0" cellspacing="0" border="0" style="max-width: 600px; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <tr>
                        <td style="background-color: #2563eb; padding: 30px 40px 20px 40px; text-align: center;">
                            <h1 style="color: #ffffff; font-size: 24px; font-weight: bold; margin: 0;">Ihr Anmelde-Code</h1>
                            <p style="color: #bfdbfe; font-size: 14px; margin: 5px 0 0 0;">FlexWise Schulplattform</p>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 40px; text-align: center;">
                            <h2 style="color: #1f2937; font-size: 20px; font-weight: bold; margin: 0 0 20px 0;">Zwei-Faktor-Authentifizierung</h2>
                            <p style="color: #4b5563; font-size: 16px; line-height: 1.5; margin: 0 0 30px 0;">
                                Verwenden Sie diesen 6-stelligen Code, um sich bei FlexWise anzumelden:
                            </p>
                            <div style="background-color: #f3f4f6; border: 2px solid #e5e7eb; border-radius: 8px; padding: 20px; margin: 20px 0;">
                                <span style="font-family: monospace; font-size: 32px; font-weight: bold; color: #2563eb; letter-spacing: 8px;">{{ .Token }}</span>
                            </div>
                            <p style="color: #6b7280; font-size: 14px; margin: 20px 0 0 0;">
                                Dieser Code ist 10 Minuten g√ºltig.
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td style="background-color: #f9fafb; padding: 20px 40px; text-align: center;">
                            <p style="color: #6b7280; font-size: 12px; margin: 0;">
                                Falls Sie diesen Code nicht angefordert haben, ignorieren Sie diese E-Mail.
                            </p>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>
</html>'

# =================================================================
# üì± SMS OTP CONFIGURATION (Using Twilio)
# =================================================================

# SMS provider configuration
GOTRUE_SMS_PROVIDER="twilio"
GOTRUE_SMS_AUTOCONFIRM="false"
GOTRUE_SMS_MAX_FREQUENCY="5s"
GOTRUE_SMS_OTP_EXP="600"  # 10 minutes
GOTRUE_SMS_OTP_LENGTH="6"

# Twilio credentials (you need to sign up at twilio.com)
GOTRUE_SMS_TWILIO_ACCOUNT_SID="YOUR_TWILIO_ACCOUNT_SID"
GOTRUE_SMS_TWILIO_AUTH_TOKEN="YOUR_TWILIO_AUTH_TOKEN"
GOTRUE_SMS_TWILIO_MESSAGE_SERVICE_SID="YOUR_TWILIO_MESSAGE_SERVICE_SID"

# Custom SMS template (German)
GOTRUE_SMS_TEMPLATE="Ihr FlexWise Anmelde-Code: {{ .Code }}. G√ºltig f√ºr 10 Minuten."

# =================================================================
# üîí MFA/OTP SECURITY CONFIGURATION
# =================================================================

# Maximum number of enrolled MFA factors per user
GOTRUE_MAX_VERIFIED_FACTORS="3"

# MFA challenge expiry
GOTRUE_MFA_CHALLENGE_EXPIRY_DURATION="600s"

# Rate limiting for OTP attempts
GOTRUE_RATE_LIMIT_EMAIL_SENT="10"
GOTRUE_RATE_LIMIT_SMS_SENT="10"

# =================================================================
# üß™ TESTING CONFIGURATION (Optional)
# =================================================================

# For testing OTP without real SMS (development only)
# GOTRUE_SMS_TEST_OTP="+4915112345678:123456, +4915187654321:654321"
# GOTRUE_SMS_TEST_OTP_VALID_UNTIL="2024-12-31T23:59:59Z"

# =================================================================
# üåê GENERAL SUPABASE SETTINGS
# =================================================================

# Site URL for redirects
GOTRUE_SITE_URL="https://flexwise.io"
GOTRUE_URI_ALLOW_LIST="https://flexwise.io,http://localhost:3000"

# Email and phone verification
GOTRUE_EXTERNAL_EMAIL_ENABLED="true"
GOTRUE_EXTERNAL_PHONE_ENABLED="true"

# Mailer URL paths
GOTRUE_MAILER_URLPATHS_CONFIRMATION="/auth/verify"
GOTRUE_MAILER_URLPATHS_RECOVERY="/auth/reset-password"
GOTRUE_MAILER_URLPATHS_EMAIL_CHANGE="/auth/verify"

# Security settings
GOTRUE_SECURITY_REFRESH_TOKEN_ROTATION_ENABLED="true"
GOTRUE_SECURITY_UPDATE_PASSWORD_REQUIRE_REAUTHENTICATION="true"

# =================================================================
# üìã SETUP INSTRUCTIONS
# =================================================================

# 1. BREVO SETUP:
#    - Get SMTP credentials from Brevo dashboard
#    - Replace YOUR_BREVO_SMTP_LOGIN and YOUR_BREVO_SMTP_KEY
#    - Test email delivery

# 2. TWILIO SETUP:
#    - Sign up at twilio.com
#    - Get Account SID, Auth Token, and Message Service SID
#    - Replace the Twilio credentials above
#    - Verify phone number for testing

# 3. SUPABASE CONFIGURATION:
#    - Add these variables to your Supabase project settings
#    - Or use them in your local Supabase setup
#    - Test OTP functionality

# 4. TESTING:
#    - Use the test OTP settings for development
#    - Remove test settings for production
