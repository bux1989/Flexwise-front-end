{"cacheVersion":75,"page":{"id":"5fe5c8f2-4c38-4459-b722-48bf993cfd52","paths":{"de":"staff-profile-popup","default":"staff-profile-popup"},"cmsDataSetPath":null,"workflows":[{"id":"6c797370-f6c7-4044-9109-370adcedc66b","actions":{"72169f7a-884b-4b2a-93a9-5b32d2f04c74":{"id":"72169f7a-884b-4b2a-93a9-5b32d2f04c74","type":"execute-workflow:4915a095-ebe9-4d51-87ae-43cf47906749"}},"trigger":"onload","firstAction":"72169f7a-884b-4b2a-93a9-5b32d2f04c74"}]},"sections":{"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523":{"uid":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523","linkId":"6883afe4-817f-430a-93c7-bad5cc341feb","_state":{"style":{"default":{}}},"content":{"default":{"wwObjects":[{"uid":"47071a9e-008c-4cf9-b7ea-5b0ea650e930","isWwObject":true},{"uid":"802e6a50-8034-40cf-a123-a184410b4370","isWwObject":true},{"uid":"0cc158ce-b80e-460c-bbb6-8e0a49f0ff93","isWwObject":true},{"uid":"1d94fe66-a391-4bda-be4b-2f04f7e364de","isWwObject":true},{"uid":"89f1ca92-490e-428b-b658-28d25dd6e8e7","isWwObject":true}],"_ww-layout_alignItems":"flex-start","_ww-layout_flexDirection":"column"}},"sectionBaseId":"99586bd3-2b15-4d6b-a025-6a50d07ca845","sectionTitle":"Section"}},"wwObjects":{"6b7423f1-032e-47cf-bf71-1853e2a9759c":{"uid":"6b7423f1-032e-47cf-bf71-1853e2a9759c","_state":{"style":{"default":{}}},"content":{"tablet":{},"default":{"tag":"p","bgColor":"","shadows":"","fontStyle":"ww-font-style-text","textColor":"","globalStyle":{},"_ww-text_text":{"de":"<div>Show lessons</div>","en":"<p>This is some text</p>"},"transformation":"","_ww-text_ellipsis":false,"_ww-text_fontSize":"16px","_ww-text_sanitize":false}},"name":"Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"da67033e-793a-42f6-9e60-4d7a1d63485e":{"uid":"da67033e-793a-42f6-9e60-4d7a1d63485e","_state":{"style":{"default":{"width":"30px","cursor":"pointer","height":"18px","transition":"all 0.3s ease 0s","borderRadius":"25px"}}},"content":{"default":{"readonly":false,"required":true,"fieldName":"","validation":"","selectorSize":"80%","selectorColorOn":"#FFFFFF","customValidation":false,"selectorColorOff":"#FFFFFF","backgroundColorOn":"#099AF2","backgroundColorOff":"#00000040"}},"name":"Toggle filter non courses","wwObjectBaseId":"1ba25bdf-dee9-4e0e-a0b8-b3f3128c3b65","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"802e6a50-8034-40cf-a123-a184410b4370":{"uid":"802e6a50-8034-40cf-a123-a184410b4370","_state":{"style":{}},"content":{"default":{"children":[{"uid":"6b7423f1-032e-47cf-bf71-1853e2a9759c","isWwObject":true},{"uid":"da67033e-793a-42f6-9e60-4d7a1d63485e","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"row"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"0cc158ce-b80e-460c-bbb6-8e0a49f0ff93":{"uid":"0cc158ce-b80e-460c-bbb6-8e0a49f0ff93","_state":{"style":{"default":{"conditionalRendering":false}},"interactions":[{"id":"767fd851-f2f9-427f-bb43-632fc47ec283","icon":"workflow","name":"Add/move asssignment","index":0,"actions":{"07dbdf91-8849-4514-b7eb-1636dcb731d8":{"id":"07dbdf91-8849-4514-b7eb-1636dcb731d8","next":"17b891dc-bb70-468d-a39a-8aa04a42c0c4","type":"variable","varId":"af517f07-181d-4118-a343-8193085cf571","disabled":false,"internal":false,"varValue":{"code":"// ===== Robust course entry builder (auto-detect STAFF collection) =====\r\n\r\n// --- Helper: safe get data array from a collection key ---\r\nfunction getData(key){\r\n  return (collections && collections[key] && Array.isArray(collections[key].data)) ? collections[key].data : [];\r\n}\r\n\r\n// --- Known collections (days/periods/subjects/rooms/schedules) ---\r\nvar daysCollection     = getData('9750c008-5b3f-4bd0-8402-d792ff4b5b3c');\r\nvar periodsCollection  = getData('cc215fad-c61a-4270-9a1b-b50c3b1bfcc9');\r\nvar subjectCollection  = getData('6e82c174-d8cb-448a-ab8a-455fd77084ce');\r\nvar roomCollection     = getData('5f37592e-5054-4720-8e8e-9b076df2b07b');\r\nvar scheduleCollection = getData('ee9baa8f-ba17-4f4b-b915-bb972423be13');\r\n\r\n// --- Payload ---\r\nvar payload = (event && event.value) ? event.value : event || {};\r\nvar draftId = payload.draftId;\r\nvar dayId = payload.dayId;\r\nvar day = payload.day;\r\nvar periodId = payload.periodId;\r\nvar period = payload.period;\r\nvar courseId = payload.courseId;\r\nvar courseName = payload.courseName || '';\r\nvar courseCode = payload.courseCode || '';\r\nvar teacherIdsIn = Array.isArray(payload.teacherIds) ? payload.teacherIds : [];\r\nvar staffIdsIn   = Array.isArray(payload.staff_ids)   ? payload.staff_ids   : [];\r\nvar primaryTeacherId = payload.primaryTeacherId;\r\nvar roomId = payload.roomId;\r\nvar subjectId = payload.subjectId;\r\n\r\n// --- Normalize helper ---\r\nfunction norm(v){ return String(v==null?'':v).trim().toLowerCase(); }\r\n\r\n// --- Lookups: day, period, room ---\r\nvar dayObj = null;\r\nfor (var i=0;i<daysCollection.length;i++){\r\n  var d = daysCollection[i];\r\n  if (norm(d.id)===norm(dayId) || d.name_de===day || d.name_en===day){ dayObj=d; break; }\r\n}\r\n\r\nvar periodObj = null;\r\nfor (var j=0;j<periodsCollection.length;j++){\r\n  var p = periodsCollection[j];\r\n  if (norm(p.id)===norm(periodId) || Number(p.block_number)===Number(period)){ periodObj=p; break; }\r\n}\r\n\r\nvar roomObj = null;\r\nfor (var k=0;k<roomCollection.length;k++){\r\n  var r = roomCollection[k];\r\n  if (norm(r.id)===norm(roomId)){ roomObj=r; break; }\r\n}\r\n\r\n// --- Find matching schedule row (optional backfill) ---\r\nvar scheduleMatch = null;\r\nfor (var s=0;s<scheduleCollection.length;s++){\r\n  var sc = scheduleCollection[s];\r\n  if (norm(sc.course_id)===norm(courseId) &&\r\n      norm(sc.day_id)===norm(dayObj ? dayObj.id : dayId) &&\r\n      norm(sc.period_id)===norm(periodObj ? periodObj.id : periodId)){\r\n    scheduleMatch = sc; break;\r\n  }\r\n}\r\n\r\n// --- Subject (payload > schedule) ---\r\nvar effectiveSubjectId = subjectId || (scheduleMatch ? scheduleMatch.subject_id : null);\r\nvar subjectObj = null;\r\nfor (var u=0;u<subjectCollection.length;u++){\r\n  var sj = subjectCollection[u];\r\n  if (norm(sj.id)===norm(effectiveSubjectId)){ subjectObj=sj; break; }\r\n}\r\n\r\n// --- Teacher IDs (merge + unique) ---\r\nvar effectiveTeacherIds = [];\r\n(staffIdsIn.length ? staffIdsIn : teacherIdsIn).forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\nif (primaryTeacherId) effectiveTeacherIds.push(String(primaryTeacherId));\r\nif (scheduleMatch && Array.isArray(scheduleMatch.teacher_ids)) {\r\n  scheduleMatch.teacher_ids.forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\n}\r\n// unique by normalized value\r\nvar seen = {};\r\neffectiveTeacherIds = effectiveTeacherIds.filter(function(id){\r\n  var k = norm(id); if (seen[k]) return false; seen[k]=true; return true;\r\n});\r\n\r\n// --- AUTO-DETECT staff collection by scanning all collections for any teacher ID ---\r\nvar staffCollection = [];\r\ntry{\r\n  var keys = Object.keys(collections || {});\r\n  for (var a=0;a<keys.length;a++){\r\n    var key = keys[a];\r\n    var arr = getData(key);\r\n    if (!arr.length) continue;\r\n    // Heuristic: staff objects have first_name/last_name; try also matching by id/profile_id\r\n    var looksLikeStaff = false;\r\n    for (var b=0;b<arr.length;b++){\r\n      var obj = arr[b];\r\n      if (obj && (('first_name' in obj) || ('last_name' in obj))) { looksLikeStaff = true; break; }\r\n    }\r\n    if (!looksLikeStaff) continue;\r\n\r\n    // Check if any teacherId matches id or profile_id in this array\r\n    var matchAny = false;\r\n    for (var c=0;c<effectiveTeacherIds.length && !matchAny;c++){\r\n      var tid = norm(effectiveTeacherIds[c]);\r\n      for (var d=0; d<arr.length; d++){\r\n        var itm = arr[d];\r\n        var id1 = itm && itm.id ? norm(itm.id) : '';\r\n        var id2 = itm && itm.profile_id ? norm(itm.profile_id) : '';\r\n        if (tid===id1 || tid===id2){ matchAny = true; break; }\r\n      }\r\n    }\r\n    if (matchAny){ staffCollection = arr; break; }\r\n  }\r\n} catch(e){ /* ignore */ }\r\n\r\n// --- Teacher names (match by id OR profile_id) ---\r\nvar teacherNames = [];\r\nfor (var t=0;t<effectiveTeacherIds.length;t++){\r\n  var tidRaw = effectiveTeacherIds[t];\r\n  var key = norm(tidRaw);\r\n  var found = null;\r\n\r\n  // fast path if staffCollection already detected\r\n  for (var m=0; m<staffCollection.length && !found; m++){\r\n    var st = staffCollection[m];\r\n    var sid = st && st.id ? norm(st.id) : '';\r\n    var spid = st && st.profile_id ? norm(st.profile_id) : '';\r\n    if (sid===key || spid===key) found = st;\r\n  }\r\n\r\n  // last resort: scan all collections once more (slow but reliable if key was wrong)\r\n  if (!found){\r\n    var keys2 = Object.keys(collections || {});\r\n    outer:\r\n    for (var x=0;x<keys2.length;x++){\r\n      var arr2 = getData(keys2[x]);\r\n      for (var y=0;y<arr2.length;y++){\r\n        var st2 = arr2[y];\r\n        if (!st2) continue;\r\n        var sid2 = st2.id ? norm(st2.id) : '';\r\n        var spid2 = st2.profile_id ? norm(st2.profile_id) : '';\r\n        // also require it to look like a staff row (has a name field)\r\n        var hasName = (('first_name' in st2) || ('last_name' in st2));\r\n        if (hasName && (sid2===key || spid2===key)){ found = st2; break outer; }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (found){\r\n    var nm = ((found.first_name || '') + ' ' + (found.last_name || '')).trim();\r\n    if (nm) teacherNames.push(nm);\r\n  }\r\n}\r\n\r\n// --- Room name fallback from schedule if needed ---\r\nvar roomName = roomObj ? roomObj.name : '';\r\nif (!roomName && scheduleMatch && scheduleMatch.room_name) roomName = scheduleMatch.room_name;\r\n\r\n// --- Entry ---\r\nvar entry = {\r\n  id: draftId || ('draft-' + Date.now()),\r\n  isDraft: true,\r\n  day_id: dayObj ? dayObj.id : (dayId || null),\r\n  day_name_en: (dayObj && dayObj.name_en) ? dayObj.name_en : (typeof day==='string'?day:''),\r\n  day_name_de: (dayObj && dayObj.name_de) ? dayObj.name_de : (typeof day==='string'?day:''),\r\n  period_id: periodObj ? periodObj.id : (periodId || null),\r\n  block_number: periodObj ? periodObj.block_number : (period || null),\r\n  course_id: courseId || null,\r\n  course_name: courseName,\r\n  course_code: courseCode,\r\n  room_id: roomObj ? roomObj.id : (roomId || (scheduleMatch ? scheduleMatch.room_id : null)),\r\n  room_name: roomName,\r\n  class_id: null,\r\n  class_name: '',\r\n  class_grade_level: null,\r\n  subject_id: subjectObj ? subjectObj.id : null,\r\n  subject_name: subjectObj ? subjectObj.name : '',\r\n  subject_color: subjectObj ? subjectObj.color : null,\r\n  subject_icon_id: subjectObj ? subjectObj.icon_id : null,\r\n  display_cell: courseCode || courseName || '',\r\n  staff_ids: effectiveTeacherIds,\r\n  teacher_names: teacherNames,\r\n  currentlyScheduled: !!scheduleMatch\r\n};\r\n\r\nreturn entry;\r\n","__wwtype":"js"},"arrayUpdateType":"push"},"17b891dc-bb70-468d-a39a-8aa04a42c0c4":{"id":"17b891dc-bb70-468d-a39a-8aa04a42c0c4","type":"variable","varId":"8f893bde-67e4-4938-8774-f988900ea044","internal":false,"varValue":"false"},"4eae5e6b-b811-4e44-b8b9-b6572fae4d54":{"id":"4eae5e6b-b811-4e44-b8b9-b6572fae4d54","type":"if","value":{"code":"wwFormulas.getKeyValue(event,\"action\")==\"move\"","__wwtype":"f"},"branches":[{"id":"e35c2797-31d1-4924-a6b5-5672e0bce9f9","value":true},{"id":"07dbdf91-8849-4514-b7eb-1636dcb731d8","value":false}],"disabled":false},"dd1d425e-89d4-4e4c-a8ad-73e257cac78f":{"id":"dd1d425e-89d4-4e4c-a8ad-73e257cac78f","next":"4eae5e6b-b811-4e44-b8b9-b6572fae4d54","type":"variable","varId":"d8e368cc-bd12-4783-bea6-c382e9577c43","internal":false,"varValue":{"code":"event","__wwtype":"f"}},"e35c2797-31d1-4924-a6b5-5672e0bce9f9":{"id":"e35c2797-31d1-4924-a6b5-5672e0bce9f9","next":"e4e81e6a-0f10-4d11-9f9f-6cdf3452bc2d","path":"day_id","type":"variable","index":{"code":"return variables['af517f07-181d-4118-a343-8193085cf571']?.findIndex(\r\n    item => item.id === event?.['draftId']\r\n);\r\n","__wwtype":"js"},"varId":"af517f07-181d-4118-a343-8193085cf571","usePath":false,"disabled":false,"internal":false,"varValue":{"code":"// ===== Robust course entry builder (auto-detect STAFF collection) =====\r\n\r\n// --- Helper: safe get data array from a collection key ---\r\nfunction getData(key){\r\n  return (collections && collections[key] && Array.isArray(collections[key].data)) ? collections[key].data : [];\r\n}\r\n\r\n// --- Known collections (days/periods/subjects/rooms/schedules) ---\r\nvar daysCollection     = getData('9750c008-5b3f-4bd0-8402-d792ff4b5b3c');\r\nvar periodsCollection  = getData('cc215fad-c61a-4270-9a1b-b50c3b1bfcc9');\r\nvar subjectCollection  = getData('6e82c174-d8cb-448a-ab8a-455fd77084ce');\r\nvar roomCollection     = getData('5f37592e-5054-4720-8e8e-9b076df2b07b');\r\nvar scheduleCollection = getData('ee9baa8f-ba17-4f4b-b915-bb972423be13');\r\n\r\n// --- Payload ---\r\nvar payload = (event && event.value) ? event.value : event || {};\r\nvar draftId = payload.draftId;\r\nvar dayId = payload.dayId;\r\nvar day = payload.day;\r\nvar periodId = payload.periodId;\r\nvar period = payload.period;\r\nvar courseId = payload.courseId;\r\nvar courseName = payload.courseName || '';\r\nvar courseCode = payload.courseCode || '';\r\nvar teacherIdsIn = Array.isArray(payload.teacherIds) ? payload.teacherIds : [];\r\nvar staffIdsIn   = Array.isArray(payload.staff_ids)   ? payload.staff_ids   : [];\r\nvar primaryTeacherId = payload.primaryTeacherId;\r\nvar roomId = payload.roomId;\r\nvar subjectId = payload.subjectId;\r\n\r\n// --- Normalize helper ---\r\nfunction norm(v){ return String(v==null?'':v).trim().toLowerCase(); }\r\n\r\n// --- Lookups: day, period, room ---\r\nvar dayObj = null;\r\nfor (var i=0;i<daysCollection.length;i++){\r\n  var d = daysCollection[i];\r\n  if (norm(d.id)===norm(dayId) || d.name_de===day || d.name_en===day){ dayObj=d; break; }\r\n}\r\n\r\nvar periodObj = null;\r\nfor (var j=0;j<periodsCollection.length;j++){\r\n  var p = periodsCollection[j];\r\n  if (norm(p.id)===norm(periodId) || Number(p.block_number)===Number(period)){ periodObj=p; break; }\r\n}\r\n\r\nvar roomObj = null;\r\nfor (var k=0;k<roomCollection.length;k++){\r\n  var r = roomCollection[k];\r\n  if (norm(r.id)===norm(roomId)){ roomObj=r; break; }\r\n}\r\n\r\n// --- Find matching schedule row (optional backfill) ---\r\nvar scheduleMatch = null;\r\nfor (var s=0;s<scheduleCollection.length;s++){\r\n  var sc = scheduleCollection[s];\r\n  if (norm(sc.course_id)===norm(courseId) &&\r\n      norm(sc.day_id)===norm(dayObj ? dayObj.id : dayId) &&\r\n      norm(sc.period_id)===norm(periodObj ? periodObj.id : periodId)){\r\n    scheduleMatch = sc; break;\r\n  }\r\n}\r\n\r\n// --- Subject (payload > schedule) ---\r\nvar effectiveSubjectId = subjectId || (scheduleMatch ? scheduleMatch.subject_id : null);\r\nvar subjectObj = null;\r\nfor (var u=0;u<subjectCollection.length;u++){\r\n  var sj = subjectCollection[u];\r\n  if (norm(sj.id)===norm(effectiveSubjectId)){ subjectObj=sj; break; }\r\n}\r\n\r\n// --- Teacher IDs (merge + unique) ---\r\nvar effectiveTeacherIds = [];\r\n(staffIdsIn.length ? staffIdsIn : teacherIdsIn).forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\nif (primaryTeacherId) effectiveTeacherIds.push(String(primaryTeacherId));\r\nif (scheduleMatch && Array.isArray(scheduleMatch.teacher_ids)) {\r\n  scheduleMatch.teacher_ids.forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\n}\r\n// unique by normalized value\r\nvar seen = {};\r\neffectiveTeacherIds = effectiveTeacherIds.filter(function(id){\r\n  var k = norm(id); if (seen[k]) return false; seen[k]=true; return true;\r\n});\r\n\r\n// --- AUTO-DETECT staff collection by scanning all collections for any teacher ID ---\r\nvar staffCollection = [];\r\ntry{\r\n  var keys = Object.keys(collections || {});\r\n  for (var a=0;a<keys.length;a++){\r\n    var key = keys[a];\r\n    var arr = getData(key);\r\n    if (!arr.length) continue;\r\n    // Heuristic: staff objects have first_name/last_name; try also matching by id/profile_id\r\n    var looksLikeStaff = false;\r\n    for (var b=0;b<arr.length;b++){\r\n      var obj = arr[b];\r\n      if (obj && (('first_name' in obj) || ('last_name' in obj))) { looksLikeStaff = true; break; }\r\n    }\r\n    if (!looksLikeStaff) continue;\r\n\r\n    // Check if any teacherId matches id or profile_id in this array\r\n    var matchAny = false;\r\n    for (var c=0;c<effectiveTeacherIds.length && !matchAny;c++){\r\n      var tid = norm(effectiveTeacherIds[c]);\r\n      for (var d=0; d<arr.length; d++){\r\n        var itm = arr[d];\r\n        var id1 = itm && itm.id ? norm(itm.id) : '';\r\n        var id2 = itm && itm.profile_id ? norm(itm.profile_id) : '';\r\n        if (tid===id1 || tid===id2){ matchAny = true; break; }\r\n      }\r\n    }\r\n    if (matchAny){ staffCollection = arr; break; }\r\n  }\r\n} catch(e){ /* ignore */ }\r\n\r\n// --- Teacher names (match by id OR profile_id) ---\r\nvar teacherNames = [];\r\nfor (var t=0;t<effectiveTeacherIds.length;t++){\r\n  var tidRaw = effectiveTeacherIds[t];\r\n  var key = norm(tidRaw);\r\n  var found = null;\r\n\r\n  // fast path if staffCollection already detected\r\n  for (var m=0; m<staffCollection.length && !found; m++){\r\n    var st = staffCollection[m];\r\n    var sid = st && st.id ? norm(st.id) : '';\r\n    var spid = st && st.profile_id ? norm(st.profile_id) : '';\r\n    if (sid===key || spid===key) found = st;\r\n  }\r\n\r\n  // last resort: scan all collections once more (slow but reliable if key was wrong)\r\n  if (!found){\r\n    var keys2 = Object.keys(collections || {});\r\n    outer:\r\n    for (var x=0;x<keys2.length;x++){\r\n      var arr2 = getData(keys2[x]);\r\n      for (var y=0;y<arr2.length;y++){\r\n        var st2 = arr2[y];\r\n        if (!st2) continue;\r\n        var sid2 = st2.id ? norm(st2.id) : '';\r\n        var spid2 = st2.profile_id ? norm(st2.profile_id) : '';\r\n        // also require it to look like a staff row (has a name field)\r\n        var hasName = (('first_name' in st2) || ('last_name' in st2));\r\n        if (hasName && (sid2===key || spid2===key)){ found = st2; break outer; }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (found){\r\n    var nm = ((found.first_name || '') + ' ' + (found.last_name || '')).trim();\r\n    if (nm) teacherNames.push(nm);\r\n  }\r\n}\r\n\r\n// --- Room name fallback from schedule if needed ---\r\nvar roomName = roomObj ? roomObj.name : '';\r\nif (!roomName && scheduleMatch && scheduleMatch.room_name) roomName = scheduleMatch.room_name;\r\n\r\n// --- Entry ---\r\nvar entry = {\r\n  id: draftId || ('draft-' + Date.now()),\r\n  isDraft: true,\r\n  day_id: dayObj ? dayObj.id : (dayId || null),\r\n  day_name_en: (dayObj && dayObj.name_en) ? dayObj.name_en : (typeof day==='string'?day:''),\r\n  day_name_de: (dayObj && dayObj.name_de) ? dayObj.name_de : (typeof day==='string'?day:''),\r\n  period_id: periodObj ? periodObj.id : (periodId || null),\r\n  block_number: periodObj ? periodObj.block_number : (period || null),\r\n  course_id: courseId || null,\r\n  course_name: courseName,\r\n  course_code: courseCode,\r\n  room_id: roomObj ? roomObj.id : (roomId || (scheduleMatch ? scheduleMatch.room_id : null)),\r\n  room_name: roomName,\r\n  class_id: null,\r\n  class_name: '',\r\n  class_grade_level: null,\r\n  subject_id: subjectObj ? subjectObj.id : null,\r\n  subject_name: subjectObj ? subjectObj.name : '',\r\n  subject_color: subjectObj ? subjectObj.color : null,\r\n  subject_icon_id: subjectObj ? subjectObj.icon_id : null,\r\n  display_cell: courseCode || courseName || '',\r\n  staff_ids: effectiveTeacherIds,\r\n  teacher_names: teacherNames,\r\n  currentlyScheduled: !!scheduleMatch\r\n};\r\n\r\nreturn entry;\r\n","__wwtype":"js"},"arrayUpdateType":"update"},"e4e81e6a-0f10-4d11-9f9f-6cdf3452bc2d":{"id":"e4e81e6a-0f10-4d11-9f9f-6cdf3452bc2d","type":"variable","varId":"8f893bde-67e4-4938-8774-f988900ea044","internal":false,"varValue":"true"}},"trigger":"scheduler:drop","isSearched":false,"description":"On Scheduler Drop","firstAction":"dd1d425e-89d4-4e4c-a8ad-73e257cac78f","triggerConditions":null},{"id":"9ab0a756-77aa-4d90-a124-c07570c9c96c","icon":"workflow","name":"Untitled workflow","index":1,"actions":{"6d6df3a6-af69-4668-856e-f2b55e3b4bc8":{"id":"6d6df3a6-af69-4668-856e-f2b55e3b4bc8","next":null,"type":"variable","varId":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","usePath":false,"disabled":false,"internal":false,"varValue":{"code":"return variables['af517f07-181d-4118-a343-8193085cf571'] =\r\n    variables['af517f07-181d-4118-a343-8193085cf571']?.filter(\r\n        item => item.id !== event?.['draftId']\r\n    );\r\n","__wwtype":"js"}},"97bedd21-adcc-4063-a492-30793a3c33f7":{"id":"97bedd21-adcc-4063-a492-30793a3c33f7","next":"6d6df3a6-af69-4668-856e-f2b55e3b4bc8","type":"variable","varId":"d8e368cc-bd12-4783-bea6-c382e9577c43","internal":false,"varValue":{"code":"event","__wwtype":"f"}}},"trigger":"scheduler:remove","isSearched":false,"description":"On Assignment Remove","firstAction":"97bedd21-adcc-4063-a492-30793a3c33f7","triggerConditions":null},{"id":"c5aaf099-13df-4835-abb2-405047630cd9","icon":"cursor","name":"Untitled workflow","index":2,"actions":{},"trigger":"click","isSearched":false,"description":"On click"}]},"content":{"default":{"mode":{"code":"variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef']","name":"Copy of formula","__wwtype":"f","defaultValue":"planning"},"rooms":{"code":"collections['5f37592e-5054-4720-8e8e-9b076df2b07b']?.['data']","name":"Copy of formula","__wwtype":"f","defaultValue":[]},"classes":{"code":"collections['b8d0c0e2-1e1a-49c1-b2e7-6d468ab46eb2']?.['data']","name":"Copy of formula","__wwtype":"f","defaultValue":[]},"courses":{"code":"collections['8e251521-1e10-45bb-8272-628c64dac5bb']?.['data']","name":"Copy of formula","sort":[{"key":"course_name","direction":"ASC"}],"__wwtype":"f","defaultValue":[]},"periods":{"code":"return collections['cc215fad-c61a-4270-9a1b-b50c3b1bfcc9']?.['data']","name":"Copy of formula","__wwtype":"js","defaultValue":[{"block_number":1},{"block_number":2},{"block_number":3}]},"subjects":{"code":"collections['6e82c174-d8cb-448a-ab8a-455fd77084ce']?.['data']","name":"Copy of formula","__wwtype":"f"},"teachers":{"code":"collections['fa8f3ff8-d844-4b42-bd94-bd420ee34fc7']?.['data']","name":"Copy of formula","__wwtype":"f","defaultValue":[]},"schoolDays":{"code":"return collections['18b475b5-a69a-4000-8dfe-1cb5558734f5']?.['data']","name":"Copy of formula","__wwtype":"js","defaultValue":[{"id":1,"name":"Monday"},{"id":2,"name":"Tuesday"},{"id":3,"name":"Wednesday"},{"id":4,"name":"Thursday"},{"id":5,"name":"Friday"}]},"liveSchedules":{"code":"collections['ee9baa8f-ba17-4f4b-b915-bb972423be13']?.['data']","name":"Copy of formula","__wwtype":"f","defaultValue":[]},"draftSchedules":{"code":"const drafts = Array.isArray(variables['af517f07-181d-4118-a343-8193085cf571'])\r\n  ? variables['af517f07-181d-4118-a343-8193085cf571']\r\n  : [];\r\n\r\nconst toggle = variables['da67033e-793a-42f6-9e60-4d7a1d63485e-value'];\r\n\r\n// If toggle is false, only show items with a course_id; otherwise show all\r\nreturn toggle === false\r\n  ? drafts.filter(item => item.course_id != null && String(item.course_id).trim() !== '')\r\n  : drafts;","name":"Copy of formula","__wwtype":"js","defaultValue":[]}}},"name":null,"wwObjectBaseId":"73b4cb5d-6351-457e-8098-a95af521d14e","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"89f1ca92-490e-428b-b658-28d25dd6e8e7":{"uid":"89f1ca92-490e-428b-b658-28d25dd6e8e7","_state":{"style":{"default":{"padding":"10px","conditionalRendering":true}},"interactions":[{"id":"198a616e-5508-42be-89b3-23a0b079cffd","icon":"workflow","name":"Add/move asssignment","index":0,"actions":{"07dbdf91-8849-4514-b7eb-1636dcb731d8":{"id":"07dbdf91-8849-4514-b7eb-1636dcb731d8","next":"17b891dc-bb70-468d-a39a-8aa04a42c0c4","type":"variable","varId":"af517f07-181d-4118-a343-8193085cf571","disabled":false,"internal":false,"varValue":{"code":"// ===== Robust course entry builder (auto-detect STAFF collection) =====\r\n\r\n// --- Helper: safe get data array from a collection key ---\r\nfunction getData(key){\r\n  return (collections && collections[key] && Array.isArray(collections[key].data)) ? collections[key].data : [];\r\n}\r\n\r\n// --- Known collections (days/periods/subjects/rooms/schedules) ---\r\nvar daysCollection     = getData('9750c008-5b3f-4bd0-8402-d792ff4b5b3c');\r\nvar periodsCollection  = getData('cc215fad-c61a-4270-9a1b-b50c3b1bfcc9');\r\nvar subjectCollection  = getData('6e82c174-d8cb-448a-ab8a-455fd77084ce');\r\nvar roomCollection     = getData('5f37592e-5054-4720-8e8e-9b076df2b07b');\r\nvar scheduleCollection = getData('ee9baa8f-ba17-4f4b-b915-bb972423be13');\r\n\r\n// --- Payload ---\r\nvar payload = (event && event.value) ? event.value : event || {};\r\nvar draftId = payload.draftId;\r\nvar dayId = payload.dayId;\r\nvar day = payload.day;\r\nvar periodId = payload.periodId;\r\nvar period = payload.period;\r\nvar courseId = payload.courseId;\r\nvar courseName = payload.courseName || '';\r\nvar courseCode = payload.courseCode || '';\r\nvar teacherIdsIn = Array.isArray(payload.teacherIds) ? payload.teacherIds : [];\r\nvar staffIdsIn   = Array.isArray(payload.staff_ids)   ? payload.staff_ids   : [];\r\nvar primaryTeacherId = payload.primaryTeacherId;\r\nvar roomId = payload.roomId;\r\nvar subjectId = payload.subjectId;\r\n\r\n// --- Normalize helper ---\r\nfunction norm(v){ return String(v==null?'':v).trim().toLowerCase(); }\r\n\r\n// --- Lookups: day, period, room ---\r\nvar dayObj = null;\r\nfor (var i=0;i<daysCollection.length;i++){\r\n  var d = daysCollection[i];\r\n  if (norm(d.id)===norm(dayId) || d.name_de===day || d.name_en===day){ dayObj=d; break; }\r\n}\r\n\r\nvar periodObj = null;\r\nfor (var j=0;j<periodsCollection.length;j++){\r\n  var p = periodsCollection[j];\r\n  if (norm(p.id)===norm(periodId) || Number(p.block_number)===Number(period)){ periodObj=p; break; }\r\n}\r\n\r\nvar roomObj = null;\r\nfor (var k=0;k<roomCollection.length;k++){\r\n  var r = roomCollection[k];\r\n  if (norm(r.id)===norm(roomId)){ roomObj=r; break; }\r\n}\r\n\r\n// --- Find matching schedule row (optional backfill) ---\r\nvar scheduleMatch = null;\r\nfor (var s=0;s<scheduleCollection.length;s++){\r\n  var sc = scheduleCollection[s];\r\n  if (norm(sc.course_id)===norm(courseId) &&\r\n      norm(sc.day_id)===norm(dayObj ? dayObj.id : dayId) &&\r\n      norm(sc.period_id)===norm(periodObj ? periodObj.id : periodId)){\r\n    scheduleMatch = sc; break;\r\n  }\r\n}\r\n\r\n// --- Subject (payload > schedule) ---\r\nvar effectiveSubjectId = subjectId || (scheduleMatch ? scheduleMatch.subject_id : null);\r\nvar subjectObj = null;\r\nfor (var u=0;u<subjectCollection.length;u++){\r\n  var sj = subjectCollection[u];\r\n  if (norm(sj.id)===norm(effectiveSubjectId)){ subjectObj=sj; break; }\r\n}\r\n\r\n// --- Teacher IDs (merge + unique) ---\r\nvar effectiveTeacherIds = [];\r\n(staffIdsIn.length ? staffIdsIn : teacherIdsIn).forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\nif (primaryTeacherId) effectiveTeacherIds.push(String(primaryTeacherId));\r\nif (scheduleMatch && Array.isArray(scheduleMatch.teacher_ids)) {\r\n  scheduleMatch.teacher_ids.forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\n}\r\n// unique by normalized value\r\nvar seen = {};\r\neffectiveTeacherIds = effectiveTeacherIds.filter(function(id){\r\n  var k = norm(id); if (seen[k]) return false; seen[k]=true; return true;\r\n});\r\n\r\n// --- AUTO-DETECT staff collection by scanning all collections for any teacher ID ---\r\nvar staffCollection = [];\r\ntry{\r\n  var keys = Object.keys(collections || {});\r\n  for (var a=0;a<keys.length;a++){\r\n    var key = keys[a];\r\n    var arr = getData(key);\r\n    if (!arr.length) continue;\r\n    // Heuristic: staff objects have first_name/last_name; try also matching by id/profile_id\r\n    var looksLikeStaff = false;\r\n    for (var b=0;b<arr.length;b++){\r\n      var obj = arr[b];\r\n      if (obj && (('first_name' in obj) || ('last_name' in obj))) { looksLikeStaff = true; break; }\r\n    }\r\n    if (!looksLikeStaff) continue;\r\n\r\n    // Check if any teacherId matches id or profile_id in this array\r\n    var matchAny = false;\r\n    for (var c=0;c<effectiveTeacherIds.length && !matchAny;c++){\r\n      var tid = norm(effectiveTeacherIds[c]);\r\n      for (var d=0; d<arr.length; d++){\r\n        var itm = arr[d];\r\n        var id1 = itm && itm.id ? norm(itm.id) : '';\r\n        var id2 = itm && itm.profile_id ? norm(itm.profile_id) : '';\r\n        if (tid===id1 || tid===id2){ matchAny = true; break; }\r\n      }\r\n    }\r\n    if (matchAny){ staffCollection = arr; break; }\r\n  }\r\n} catch(e){ /* ignore */ }\r\n\r\n// --- Teacher names (match by id OR profile_id) ---\r\nvar teacherNames = [];\r\nfor (var t=0;t<effectiveTeacherIds.length;t++){\r\n  var tidRaw = effectiveTeacherIds[t];\r\n  var key = norm(tidRaw);\r\n  var found = null;\r\n\r\n  // fast path if staffCollection already detected\r\n  for (var m=0; m<staffCollection.length && !found; m++){\r\n    var st = staffCollection[m];\r\n    var sid = st && st.id ? norm(st.id) : '';\r\n    var spid = st && st.profile_id ? norm(st.profile_id) : '';\r\n    if (sid===key || spid===key) found = st;\r\n  }\r\n\r\n  // last resort: scan all collections once more (slow but reliable if key was wrong)\r\n  if (!found){\r\n    var keys2 = Object.keys(collections || {});\r\n    outer:\r\n    for (var x=0;x<keys2.length;x++){\r\n      var arr2 = getData(keys2[x]);\r\n      for (var y=0;y<arr2.length;y++){\r\n        var st2 = arr2[y];\r\n        if (!st2) continue;\r\n        var sid2 = st2.id ? norm(st2.id) : '';\r\n        var spid2 = st2.profile_id ? norm(st2.profile_id) : '';\r\n        // also require it to look like a staff row (has a name field)\r\n        var hasName = (('first_name' in st2) || ('last_name' in st2));\r\n        if (hasName && (sid2===key || spid2===key)){ found = st2; break outer; }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (found){\r\n    var nm = ((found.first_name || '') + ' ' + (found.last_name || '')).trim();\r\n    if (nm) teacherNames.push(nm);\r\n  }\r\n}\r\n\r\n// --- Room name fallback from schedule if needed ---\r\nvar roomName = roomObj ? roomObj.name : '';\r\nif (!roomName && scheduleMatch && scheduleMatch.room_name) roomName = scheduleMatch.room_name;\r\n\r\n// --- Entry ---\r\nvar entry = {\r\n  id: draftId || ('draft-' + Date.now()),\r\n  isDraft: true,\r\n  day_id: dayObj ? dayObj.id : (dayId || null),\r\n  day_name_en: (dayObj && dayObj.name_en) ? dayObj.name_en : (typeof day==='string'?day:''),\r\n  day_name_de: (dayObj && dayObj.name_de) ? dayObj.name_de : (typeof day==='string'?day:''),\r\n  period_id: periodObj ? periodObj.id : (periodId || null),\r\n  block_number: periodObj ? periodObj.block_number : (period || null),\r\n  course_id: courseId || null,\r\n  course_name: courseName,\r\n  course_code: courseCode,\r\n  room_id: roomObj ? roomObj.id : (roomId || (scheduleMatch ? scheduleMatch.room_id : null)),\r\n  room_name: roomName,\r\n  class_id: null,\r\n  class_name: '',\r\n  class_grade_level: null,\r\n  subject_id: subjectObj ? subjectObj.id : null,\r\n  subject_name: subjectObj ? subjectObj.name : '',\r\n  subject_color: subjectObj ? subjectObj.color : null,\r\n  subject_icon_id: subjectObj ? subjectObj.icon_id : null,\r\n  display_cell: courseCode || courseName || '',\r\n  staff_ids: effectiveTeacherIds,\r\n  teacher_names: teacherNames,\r\n  currentlyScheduled: !!scheduleMatch\r\n};\r\n\r\nreturn entry;\r\n","__wwtype":"js"},"arrayUpdateType":"push"},"17b891dc-bb70-468d-a39a-8aa04a42c0c4":{"id":"17b891dc-bb70-468d-a39a-8aa04a42c0c4","type":"variable","varId":"8f893bde-67e4-4938-8774-f988900ea044","internal":false,"varValue":"false"},"4eae5e6b-b811-4e44-b8b9-b6572fae4d54":{"id":"4eae5e6b-b811-4e44-b8b9-b6572fae4d54","type":"if","value":{"code":"wwFormulas.getKeyValue(event,\"action\")==\"move\"","__wwtype":"f"},"branches":[{"id":"e35c2797-31d1-4924-a6b5-5672e0bce9f9","value":true},{"id":"07dbdf91-8849-4514-b7eb-1636dcb731d8","value":false}],"disabled":false},"dd1d425e-89d4-4e4c-a8ad-73e257cac78f":{"id":"dd1d425e-89d4-4e4c-a8ad-73e257cac78f","next":"4eae5e6b-b811-4e44-b8b9-b6572fae4d54","type":"variable","varId":"d8e368cc-bd12-4783-bea6-c382e9577c43","internal":false,"varValue":{"code":"event","__wwtype":"f"}},"e35c2797-31d1-4924-a6b5-5672e0bce9f9":{"id":"e35c2797-31d1-4924-a6b5-5672e0bce9f9","next":"e4e81e6a-0f10-4d11-9f9f-6cdf3452bc2d","path":"day_id","type":"variable","index":{"code":"return variables['af517f07-181d-4118-a343-8193085cf571']?.findIndex(\r\n    item => item.id === event?.['draftId']\r\n);\r\n","__wwtype":"js"},"varId":"af517f07-181d-4118-a343-8193085cf571","usePath":false,"disabled":false,"internal":false,"varValue":{"code":"// ===== Robust course entry builder (auto-detect STAFF collection) =====\r\n\r\n// --- Helper: safe get data array from a collection key ---\r\nfunction getData(key){\r\n  return (collections && collections[key] && Array.isArray(collections[key].data)) ? collections[key].data : [];\r\n}\r\n\r\n// --- Known collections (days/periods/subjects/rooms/schedules) ---\r\nvar daysCollection     = getData('9750c008-5b3f-4bd0-8402-d792ff4b5b3c');\r\nvar periodsCollection  = getData('cc215fad-c61a-4270-9a1b-b50c3b1bfcc9');\r\nvar subjectCollection  = getData('6e82c174-d8cb-448a-ab8a-455fd77084ce');\r\nvar roomCollection     = getData('5f37592e-5054-4720-8e8e-9b076df2b07b');\r\nvar scheduleCollection = getData('ee9baa8f-ba17-4f4b-b915-bb972423be13');\r\n\r\n// --- Payload ---\r\nvar payload = (event && event.value) ? event.value : event || {};\r\nvar draftId = payload.draftId;\r\nvar dayId = payload.dayId;\r\nvar day = payload.day;\r\nvar periodId = payload.periodId;\r\nvar period = payload.period;\r\nvar courseId = payload.courseId;\r\nvar courseName = payload.courseName || '';\r\nvar courseCode = payload.courseCode || '';\r\nvar teacherIdsIn = Array.isArray(payload.teacherIds) ? payload.teacherIds : [];\r\nvar staffIdsIn   = Array.isArray(payload.staff_ids)   ? payload.staff_ids   : [];\r\nvar primaryTeacherId = payload.primaryTeacherId;\r\nvar roomId = payload.roomId;\r\nvar subjectId = payload.subjectId;\r\n\r\n// --- Normalize helper ---\r\nfunction norm(v){ return String(v==null?'':v).trim().toLowerCase(); }\r\n\r\n// --- Lookups: day, period, room ---\r\nvar dayObj = null;\r\nfor (var i=0;i<daysCollection.length;i++){\r\n  var d = daysCollection[i];\r\n  if (norm(d.id)===norm(dayId) || d.name_de===day || d.name_en===day){ dayObj=d; break; }\r\n}\r\n\r\nvar periodObj = null;\r\nfor (var j=0;j<periodsCollection.length;j++){\r\n  var p = periodsCollection[j];\r\n  if (norm(p.id)===norm(periodId) || Number(p.block_number)===Number(period)){ periodObj=p; break; }\r\n}\r\n\r\nvar roomObj = null;\r\nfor (var k=0;k<roomCollection.length;k++){\r\n  var r = roomCollection[k];\r\n  if (norm(r.id)===norm(roomId)){ roomObj=r; break; }\r\n}\r\n\r\n// --- Find matching schedule row (optional backfill) ---\r\nvar scheduleMatch = null;\r\nfor (var s=0;s<scheduleCollection.length;s++){\r\n  var sc = scheduleCollection[s];\r\n  if (norm(sc.course_id)===norm(courseId) &&\r\n      norm(sc.day_id)===norm(dayObj ? dayObj.id : dayId) &&\r\n      norm(sc.period_id)===norm(periodObj ? periodObj.id : periodId)){\r\n    scheduleMatch = sc; break;\r\n  }\r\n}\r\n\r\n// --- Subject (payload > schedule) ---\r\nvar effectiveSubjectId = subjectId || (scheduleMatch ? scheduleMatch.subject_id : null);\r\nvar subjectObj = null;\r\nfor (var u=0;u<subjectCollection.length;u++){\r\n  var sj = subjectCollection[u];\r\n  if (norm(sj.id)===norm(effectiveSubjectId)){ subjectObj=sj; break; }\r\n}\r\n\r\n// --- Teacher IDs (merge + unique) ---\r\nvar effectiveTeacherIds = [];\r\n(staffIdsIn.length ? staffIdsIn : teacherIdsIn).forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\nif (primaryTeacherId) effectiveTeacherIds.push(String(primaryTeacherId));\r\nif (scheduleMatch && Array.isArray(scheduleMatch.teacher_ids)) {\r\n  scheduleMatch.teacher_ids.forEach(function(id){ if (id!=null) effectiveTeacherIds.push(String(id)); });\r\n}\r\n// unique by normalized value\r\nvar seen = {};\r\neffectiveTeacherIds = effectiveTeacherIds.filter(function(id){\r\n  var k = norm(id); if (seen[k]) return false; seen[k]=true; return true;\r\n});\r\n\r\n// --- AUTO-DETECT staff collection by scanning all collections for any teacher ID ---\r\nvar staffCollection = [];\r\ntry{\r\n  var keys = Object.keys(collections || {});\r\n  for (var a=0;a<keys.length;a++){\r\n    var key = keys[a];\r\n    var arr = getData(key);\r\n    if (!arr.length) continue;\r\n    // Heuristic: staff objects have first_name/last_name; try also matching by id/profile_id\r\n    var looksLikeStaff = false;\r\n    for (var b=0;b<arr.length;b++){\r\n      var obj = arr[b];\r\n      if (obj && (('first_name' in obj) || ('last_name' in obj))) { looksLikeStaff = true; break; }\r\n    }\r\n    if (!looksLikeStaff) continue;\r\n\r\n    // Check if any teacherId matches id or profile_id in this array\r\n    var matchAny = false;\r\n    for (var c=0;c<effectiveTeacherIds.length && !matchAny;c++){\r\n      var tid = norm(effectiveTeacherIds[c]);\r\n      for (var d=0; d<arr.length; d++){\r\n        var itm = arr[d];\r\n        var id1 = itm && itm.id ? norm(itm.id) : '';\r\n        var id2 = itm && itm.profile_id ? norm(itm.profile_id) : '';\r\n        if (tid===id1 || tid===id2){ matchAny = true; break; }\r\n      }\r\n    }\r\n    if (matchAny){ staffCollection = arr; break; }\r\n  }\r\n} catch(e){ /* ignore */ }\r\n\r\n// --- Teacher names (match by id OR profile_id) ---\r\nvar teacherNames = [];\r\nfor (var t=0;t<effectiveTeacherIds.length;t++){\r\n  var tidRaw = effectiveTeacherIds[t];\r\n  var key = norm(tidRaw);\r\n  var found = null;\r\n\r\n  // fast path if staffCollection already detected\r\n  for (var m=0; m<staffCollection.length && !found; m++){\r\n    var st = staffCollection[m];\r\n    var sid = st && st.id ? norm(st.id) : '';\r\n    var spid = st && st.profile_id ? norm(st.profile_id) : '';\r\n    if (sid===key || spid===key) found = st;\r\n  }\r\n\r\n  // last resort: scan all collections once more (slow but reliable if key was wrong)\r\n  if (!found){\r\n    var keys2 = Object.keys(collections || {});\r\n    outer:\r\n    for (var x=0;x<keys2.length;x++){\r\n      var arr2 = getData(keys2[x]);\r\n      for (var y=0;y<arr2.length;y++){\r\n        var st2 = arr2[y];\r\n        if (!st2) continue;\r\n        var sid2 = st2.id ? norm(st2.id) : '';\r\n        var spid2 = st2.profile_id ? norm(st2.profile_id) : '';\r\n        // also require it to look like a staff row (has a name field)\r\n        var hasName = (('first_name' in st2) || ('last_name' in st2));\r\n        if (hasName && (sid2===key || spid2===key)){ found = st2; break outer; }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (found){\r\n    var nm = ((found.first_name || '') + ' ' + (found.last_name || '')).trim();\r\n    if (nm) teacherNames.push(nm);\r\n  }\r\n}\r\n\r\n// --- Room name fallback from schedule if needed ---\r\nvar roomName = roomObj ? roomObj.name : '';\r\nif (!roomName && scheduleMatch && scheduleMatch.room_name) roomName = scheduleMatch.room_name;\r\n\r\n// --- Entry ---\r\nvar entry = {\r\n  id: draftId || ('draft-' + Date.now()),\r\n  isDraft: true,\r\n  day_id: dayObj ? dayObj.id : (dayId || null),\r\n  day_name_en: (dayObj && dayObj.name_en) ? dayObj.name_en : (typeof day==='string'?day:''),\r\n  day_name_de: (dayObj && dayObj.name_de) ? dayObj.name_de : (typeof day==='string'?day:''),\r\n  period_id: periodObj ? periodObj.id : (periodId || null),\r\n  block_number: periodObj ? periodObj.block_number : (period || null),\r\n  course_id: courseId || null,\r\n  course_name: courseName,\r\n  course_code: courseCode,\r\n  room_id: roomObj ? roomObj.id : (roomId || (scheduleMatch ? scheduleMatch.room_id : null)),\r\n  room_name: roomName,\r\n  class_id: null,\r\n  class_name: '',\r\n  class_grade_level: null,\r\n  subject_id: subjectObj ? subjectObj.id : null,\r\n  subject_name: subjectObj ? subjectObj.name : '',\r\n  subject_color: subjectObj ? subjectObj.color : null,\r\n  subject_icon_id: subjectObj ? subjectObj.icon_id : null,\r\n  display_cell: courseCode || courseName || '',\r\n  staff_ids: effectiveTeacherIds,\r\n  teacher_names: teacherNames,\r\n  currentlyScheduled: !!scheduleMatch\r\n};\r\n\r\nreturn entry;\r\n","__wwtype":"js"},"arrayUpdateType":"update"},"e4e81e6a-0f10-4d11-9f9f-6cdf3452bc2d":{"id":"e4e81e6a-0f10-4d11-9f9f-6cdf3452bc2d","type":"variable","varId":"8f893bde-67e4-4938-8774-f988900ea044","internal":false,"varValue":"true"}},"trigger":"scheduler:drop","isSearched":false,"description":"On Scheduler Drop","firstAction":"dd1d425e-89d4-4e4c-a8ad-73e257cac78f","triggerConditions":null},{"id":"6a1ae947-c193-4f1f-8871-516d5c5a9390","actions":{"6d6df3a6-af69-4668-856e-f2b55e3b4bc8":{"id":"6d6df3a6-af69-4668-856e-f2b55e3b4bc8","next":null,"type":"variable","varId":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","usePath":false,"disabled":false,"internal":false,"varValue":{"code":"return variables['af517f07-181d-4118-a343-8193085cf571'] =\r\n    variables['af517f07-181d-4118-a343-8193085cf571']?.filter(\r\n        item => item.id !== event?.['draftId']\r\n    );\r\n","__wwtype":"js"}},"97bedd21-adcc-4063-a492-30793a3c33f7":{"id":"97bedd21-adcc-4063-a492-30793a3c33f7","next":"6d6df3a6-af69-4668-856e-f2b55e3b4bc8","type":"variable","varId":"d8e368cc-bd12-4783-bea6-c382e9577c43","internal":false,"varValue":{"code":"event","__wwtype":"f"}}},"trigger":"scheduler:remove","firstAction":"97bedd21-adcc-4063-a492-30793a3c33f7","triggerConditions":null},{"id":"d2fca647-131b-4563-92ee-0c65b051847a","actions":{},"trigger":"click"}]},"content":{"default":{"mode":{"code":"variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef']","__wwtype":"f","defaultValue":"planning"},"rooms":{"code":"collections['5f37592e-5054-4720-8e8e-9b076df2b07b']?.['data']","__wwtype":"f","defaultValue":[]},"classes":{"code":"collections['b8d0c0e2-1e1a-49c1-b2e7-6d468ab46eb2']?.['data']","__wwtype":"f","defaultValue":[]},"courses":{"code":"collections['8e251521-1e10-45bb-8272-628c64dac5bb']?.['data']","sort":[{"key":"course_name","direction":"ASC"}],"__wwtype":"f","defaultValue":[]},"draftId":{"code":"collections['06961c10-9632-4582-9f15-bb9ba8e53d61']?.['data']?.[0]?.['id']","__wwtype":"f","defaultValue":null},"periods":{"code":"return collections['cc215fad-c61a-4270-9a1b-b50c3b1bfcc9']?.['data']","name":"Copy of formula","__wwtype":"js","defaultValue":[{"block_number":1},{"block_number":2},{"block_number":3}]},"schoolId":{"code":"collections['5a94bf43-aa17-443b-8075-2f49611c7f71']?.['data']?.[0]?.['id']","__wwtype":"f","defaultValue":null},"subjects":{"code":"collections['6e82c174-d8cb-448a-ab8a-455fd77084ce']?.['data']","__wwtype":"f"},"teachers":{"code":"collections['fa8f3ff8-d844-4b42-bd94-bd420ee34fc7']?.['data']","__wwtype":"f","defaultValue":[]},"isLiveMode":{"code":"variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef']==\"live\"","name":"Copy of formula","__wwtype":"f","defaultValue":true},"schoolDays":{"code":"return collections['18b475b5-a69a-4000-8dfe-1cb5558734f5']?.['data']","__wwtype":"js","defaultValue":[{"id":1,"name":"Monday"},{"id":2,"name":"Tuesday"},{"id":3,"name":"Wednesday"},{"id":4,"name":"Thursday"},{"id":5,"name":"Friday"}]},"publishedBy":{"code":"pluginVariables['1fa0dd68-5069-436c-9a7d-3b54c340f1fa']['user']?.['id']","__wwtype":"f","defaultValue":null},"liveSchedules":{"code":"collections['ee9baa8f-ba17-4f4b-b915-bb972423be13']?.['data']","filter":{"link":"$and","conditions":[]},"__wwtype":"f","defaultValue":[]},"draftSchedules":{"code":"const drafts = Array.isArray(variables['af517f07-181d-4118-a343-8193085cf571'])\r\n  ? variables['af517f07-181d-4118-a343-8193085cf571']\r\n  : [];\r\n\r\nconst toggle = variables['da67033e-793a-42f6-9e60-4d7a1d63485e-value'];\r\n\r\n// If toggle is false, only show items with a course_id; otherwise show all\r\nreturn toggle === false\r\n  ? drafts.filter(item => item.course_id != null && String(item.course_id).trim() !== '')\r\n  : drafts;","__wwtype":"js","defaultValue":[]},"emitDropEvents":false}},"name":null,"wwObjectBaseId":"32d8e9f5-99f4-4c13-926a-52282b3bf182","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"87a22592-63bd-458d-a3bd-3a15a4643aac":{"uid":"87a22592-63bd-458d-a3bd-3a15a4643aac","_state":{"style":{"default":{"width":"18px","height":"auto","margin":"0 8px 0 0"},"active_default":{},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"icon":"lucide/activity","color":"#64748b"},"active_default":{"color":"white"},"_wwHover_default":{}},"name":"Live Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"1d94fe66-a391-4bda-be4b-2f04f7e364de":{"uid":"1d94fe66-a391-4bda-be4b-2f04f7e364de","_state":{"style":{"default":{}}},"content":{"default":{"children":[],"_ww-layout_alignItems":"flex-start","_ww-layout_flexDirection":"column"}},"name":"Div","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"913fd9b8-16da-43db-9895-fde8f0eeb894":{"uid":"913fd9b8-16da-43db-9895-fde8f0eeb894","_state":{"style":{"default":{"width":"18px","height":"auto","margin":"0 8px 0 0"},"active_default":{},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"icon":"lucide/calendar","color":"#64748b"},"active_default":{"color":"white"},"_wwHover_default":{}},"name":"Planning Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"e51ab518-e086-4640-abdc-ba7d1f7ca9c7":{"uid":"e51ab518-e086-4640-abdc-ba7d1f7ca9c7","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"10px 16px","minWidth":"120px","maxHeight":"30px","transition":"all 0.3s ease","borderRadius":"6px","backgroundColor":"transparent"},"active_default":{"boxShadow":"0px 2px 4px rgba(59, 130, 246, 0.3)","backgroundColor":"#3b82f6"},"_wwHover_default":{"backgroundColor":"#e2e8f0"}},"states":[{"id":"active","label":"Active","condition":{"code":"variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef'] === \"planning\"","__wwtype":"f"}}],"interactions":[{"id":"5868c9a5-4413-440f-a068-49d181cb312c","icon":"cursor","name":"Open Draft Selection Popup","index":0,"actions":{"action_ia_id":{"id":"action_ia_id","code":"const result = await utilsFunctions.openPopup('1d81391f-2e84-4504-b916-973a6d719b8a', {});\n\nif (result === 'load') {\n  // Load previous draft data\n  if (localStorage.getItem('previousDraft')) {\n    variables['ea39834a-669d-4aeb-86e9-51c29a72498e'] = JSON.parse(localStorage.getItem('previousDraft'));\n  }\n} else if (result === 'new') {\n  // Clear draft data and start fresh\n  variables['ea39834a-669d-4aeb-86e9-51c29a72498e'] = null;\n}\n","type":"custom-js"}},"trigger":"click","isSearched":false,"description":"On click","firstAction":"action_ia_id"}]},"content":{"default":{"text":{"en":"Planungsansicht"},"disabled":false,"leftIcon":{"uid":"913fd9b8-16da-43db-9895-fde8f0eeb894","isWwObject":true},"buttonType":"button","hasLeftIcon":true,"_ww-text_text":{"en":"<div>Planung</div>"},"_ww-text_color":"#64748b","_ww-text_fontSize":"14px","_ww-text_fontWeight":"500"},"active_default":{"_ww-text_color":"white"},"_wwHover_default":{"_ww-text_color":"#334155"}},"name":"Planning View Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"e9e7d451-bf44-4a33-a891-dd7860123f77":{"uid":"e9e7d451-bf44-4a33-a891-dd7860123f77","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"10px 16px","minWidth":"120px","maxHeight":"30px","transition":"all 0.3s ease","borderRadius":"6px","backgroundColor":"transparent"},"active_default":{"boxShadow":"0px 2px 4px rgba(59, 130, 246, 0.3)","backgroundColor":"#3b82f6"},"_wwHover_default":{"backgroundColor":"#e2e8f0"}},"states":[{"id":"active","label":"Active","condition":{"code":"variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef'] === \"live\"","__wwtype":"f"}}],"interactions":[{"id":"860f8dcc-b4d9-4fc0-b620-906e2ba3ce81","name":"Set Live View","actions":{"4cb11873-84d6-49c0-9176-dc0db95eb323":{"id":"4cb11873-84d6-49c0-9176-dc0db95eb323","type":"fetch-collection","collectionId":"06961c10-9632-4582-9f15-bb9ba8e53d61"},"abd69feb-c132-423b-9d22-2e8c56f3c61a":{"id":"abd69feb-c132-423b-9d22-2e8c56f3c61a","next":"4cb11873-84d6-49c0-9176-dc0db95eb323","type":"reset-variables","varsId":["571fccfc-05c5-4f60-a429-6e5aa50dd3b9-value","af517f07-181d-4118-a343-8193085cf571","5c5431d0-9891-49de-bfd1-67d2dd7a8143","a7727850-d6e3-4253-9b22-2e9ecc1209ce","b99a8b46-70c2-4f04-ac6f-90044620c4a5","81cf6332-a7bc-4d6a-94cf-502db37bf689","4d1b4e2c-7a4b-473e-8556-5d559123999f","48b3a5ce-9774-47ff-bf75-5b57918a9334","ed1819ac-5afa-44a3-b0d1-4637fb1d92ef"]}},"trigger":"click","description":"Sets the planning view mode to live","firstAction":"abd69feb-c132-423b-9d22-2e8c56f3c61a"}]},"content":{"default":{"text":{"en":"Live-Ansicht"},"disabled":false,"leftIcon":{"uid":"87a22592-63bd-458d-a3bd-3a15a4643aac","isWwObject":true},"buttonType":"button","hasLeftIcon":true,"_ww-text_text":{"en":"<div>Live</div>"},"_ww-text_color":"#64748b","_ww-text_fontSize":"14px","_ww-text_fontWeight":"500"},"active_default":{"_ww-text_color":"white"},"_wwHover_default":{"_ww-text_color":"#334155"}},"name":"Live View Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"47071a9e-008c-4cf9-b7ea-5b0ea650e930":{"uid":"47071a9e-008c-4cf9-b7ea-5b0ea650e930","_state":{"style":{"default":{"flex":"0 1 auto","align":"flex-end","display":"flex","padding":"4px","boxShadow":"0px 2px 4px rgba(0, 0, 0, 0.05)","transition":"all 0.3s ease","borderRadius":"8px","backgroundColor":"#f3f4f6"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"e9e7d451-bf44-4a33-a891-dd7860123f77","isWwObject":true},{"uid":"e51ab518-e086-4640-abdc-ba7d1f7ca9c7","isWwObject":true}],"_ww-layout_flexDirection":"row","_ww-layout_justifyContent":"flex-end"}},"name":"Toggle Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentSectionId":"260b6ac7-8bf4-4aae-a4a4-7dd290b7d523"},"37b32b96-0043-42ba-8e15-1fa0eedb791c":{"uid":"37b32b96-0043-42ba-8e15-1fa0eedb791c","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"e1de03b7-3d3e-483c-b897-10365080e932":{"uid":"e1de03b7-3d3e-483c-b897-10365080e932","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"be93e09d-24be-489c-a066-f4a8e374f13b":{"uid":"be93e09d-24be-489c-a066-f4a8e374f13b","_state":{"style":{"default":{"align":"flex-end"}}},"content":{"default":{"children":[{"uid":"59886854-a759-41d8-a062-6bff1879655d","isWwObject":true},{"uid":"ed8ca887-74b2-4297-a0a9-617eaa649844","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"row"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"b7c6496a-f1c7-44df-b591-1c639b757ade":{"uid":"b7c6496a-f1c7-44df-b591-1c639b757ade","_state":{"style":{"default":{"cursor":"pointer","zIndex":null,"display":"flex","padding":"16px","boxShadow":"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)","transition":"all 0.2s ease","borderRadius":"8px","animationDelay":{"code":"context.item.index * 100 + 'ms'","__wwtype":"f"},"backgroundColor":"white","animationDuration":"400ms","animationFillMode":"both","animationKeyframes":"@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }","animationIterationCount":"1","animationTimingFunction":"ease-out"},"_wwHover_default":{"display":"flex","boxShadow":"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)","transform":"translateY(-2px)","backgroundColor":"#f1f5f9"}},"states":[{"id":"_wwHover","label":"hover","isAppliedToChidlrenElements":true}],"interactions":[]},"content":{"default":{"children":[{"uid":"75d22851-2087-4529-b657-ab3b11602ae2","isWwObject":true},{"uid":"b6c886ae-f810-43b7-ae9a-811f328353b4","isWwObject":true},{"uid":"be93e09d-24be-489c-a066-f4a8e374f13b","isWwObject":true}],"_ww-layout_flexDirection":"column"},"_wwHover_default":{}},"name":"Draft Item","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"ed8ca887-74b2-4297-a0a9-617eaa649844":{"uid":"ed8ca887-74b2-4297-a0a9-617eaa649844","_state":{"style":{"default":{"align":"flex-end","border":"none","cursor":"pointer","zIndex":null,"padding":"5px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"fe0c4439-85fe-4384-ac20-081584f43feb","icon":"cursor","name":"load draft","index":0,"actions":{"05632af2-2182-42ce-9db9-437b0869633c":{"id":"05632af2-2182-42ce-9db9-437b0869633c","next":"c66240b6-acbe-4835-b29c-92248f1dd305","type":"variable","varId":"f85a1c6d-4075-424a-a54b-febff92b7ccf","internal":false,"varValue":false},"40254813-0357-41f6-9d55-299488404c40":{"id":"40254813-0357-41f6-9d55-299488404c40","next":"d8c6d4a5-8590-42c0-9900-d2402385a428","type":"_wwLocalMethod_popup.close","disabled":false},"4c953f1c-ff95-4c43-8705-52112c4fda26":{"id":"4c953f1c-ff95-4c43-8705-52112c4fda26","next":"05632af2-2182-42ce-9db9-437b0869633c","type":"reset-variables","varsId":["2c6bd0f7-f035-4093-8ec1-3c56184a6c4f"],"disabled":false},"545f4b82-6982-49e4-8b6e-583eb90f4597":{"id":"545f4b82-6982-49e4-8b6e-583eb90f4597","next":"c0b8bcee-263f-4db1-ad78-5e242888123a","type":"variable","varId":"af517f07-181d-4118-a343-8193085cf571","internal":false,"varValue":{"code":"// -- Input Data\r\nconst draft = context.item.data?.['current_version'] ?? [];\r\n\r\n// -- Utility: Create safe composite key (if needed later)\r\nfunction generateKey(item) {\r\n  const day_id = item.day_id ?? 'NO_DAY';\r\n  const period_id = item.period_id ?? 'NO_PERIOD';\r\n  const rawId = item.course_id ?? item.class_id ?? 'NO_ID';\r\n  const normalizedId = typeof rawId === 'string' ? rawId.toLowerCase() : rawId;\r\n  return `${day_id}|${period_id}|${normalizedId}`;\r\n}\r\n\r\n// -- Normalize draft into a map (optional, in case of deduping by key)\r\nconst draftMap = {};\r\ndraft.forEach(item => {\r\n  const key = generateKey(item);\r\n  draftMap[key] = {\r\n    ...item,\r\n    isDraft: true,\r\n    currentlyScheduled: true,\r\n    staff_ids: item.staff_ids ?? [],\r\n    teacher_names: item.teacher_names ?? [],\r\n    scheduled_room_name: item.scheduled_room_name ?? '',\r\n    room_name: item.room_name ?? '',\r\n    class_name: item.class_name ?? '',\r\n    course_name: item.course_name ?? '',\r\n    day_name_de: item.day_name_de ?? '',\r\n    day_name_en: item.day_name_en ?? '',\r\n    block_number: item.block_number ?? null,\r\n    display_cell: item.display_cell ?? '',\r\n    subject_name: item.subject_name ?? '',\r\n    subject_color: item.subject_color ?? null,\r\n    subject_icon_id: item.subject_icon_id ?? null,\r\n    class_grade_level: item.class_grade_level ?? null,\r\n  };\r\n});\r\n\r\n// -- Final array\r\nconst normalizedDraftOnly = Object.values(draftMap);\r\n\r\nreturn normalizedDraftOnly;\r\n","__wwtype":"js"}},"b8669f5a-b4f5-4bec-bcfb-f5acfd383bb4":{"id":"b8669f5a-b4f5-4bec-bcfb-f5acfd383bb4","next":"545f4b82-6982-49e4-8b6e-583eb90f4597","type":"variable","varId":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","disabled":false,"internal":false,"varValue":{"code":"context.item.data","__wwtype":"f"}},"c0b8bcee-263f-4db1-ad78-5e242888123a":{"id":"c0b8bcee-263f-4db1-ad78-5e242888123a","next":"4c953f1c-ff95-4c43-8705-52112c4fda26","type":"variable","varId":"ed1819ac-5afa-44a3-b0d1-4637fb1d92ef","internal":false,"varValue":"planning"},"c66240b6-acbe-4835-b29c-92248f1dd305":{"id":"c66240b6-acbe-4835-b29c-92248f1dd305","type":"execute-workflow:9ccf593d-9e4c-4e94-84cd-e58d82a7f2fa","disabled":true},"d8c6d4a5-8590-42c0-9900-d2402385a428":{"id":"d8c6d4a5-8590-42c0-9900-d2402385a428","next":"b8669f5a-b4f5-4bec-bcfb-f5acfd383bb4","type":"variable","varId":"f85a1c6d-4075-424a-a54b-febff92b7ccf","internal":false,"varValue":true}},"trigger":"click","isSearched":false,"description":"On click","firstAction":"40254813-0357-41f6-9d55-299488404c40"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"e1de03b7-3d3e-483c-b897-10365080e932","isWwObject":true},"rightIcon":{"uid":"37b32b96-0043-42ba-8e15-1fa0eedb791c","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","de":"<div>Laden ohne schedule date</div>","en":"<div>Load</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"810b7e20-aefa-46b3-af54-885e3580e9df":{"uid":"810b7e20-aefa-46b3-af54-885e3580e9df","_state":{"style":{"default":{}}},"content":{"tablet":{},"default":{"tag":"p","bgColor":"","shadows":"","fontStyle":"ww-font-style-text","textColor":"","globalStyle":{},"_ww-text_text":{"en":"<div>Description / Notes</div>"},"transformation":"","_ww-text_ellipsis":false,"_ww-text_fontSize":"16px","_ww-text_sanitize":false,"_ww-text_fontWeight":500}},"name":"Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"a0864d9d-f95e-4383-8235-7a0a14ad1ab1":{"uid":"a0864d9d-f95e-4383-8235-7a0a14ad1ab1","_state":{"style":{"default":{"display":"flex","padding":"0 0 8px 0","borderBottom":"2px solid #e2e8f0"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"efd08839-c494-4e1f-a926-600520b79e4c","isWwObject":true},{"uid":"d7c77ec1-bae5-48e7-b1cc-2ac5f901f8bc","isWwObject":true}],"_ww-layout_rowGap":"12px","_ww-layout_columnGap":"12px","_ww-layout_alignItems":"center","_ww-layout_flexDirection":"row"}},"name":"Semester Header","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"12827b03-65a3-433e-aa23-f8ee42ee712c":{"uid":"12827b03-65a3-433e-aa23-f8ee42ee712c","_state":{"style":{"default":{"width":"100%","display":"flex","maxWidth":"940px"}}},"content":{"default":{"children":[{"uid":"9fe852cc-17c3-4959-ba45-b28507469192","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":"Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"0fab93fe-7255-46c0-a342-be0b00e24619":{"uid":"0fab93fe-7255-46c0-a342-be0b00e24619","_state":{"style":{}},"content":{"default":{"children":[{"uid":"d0d74739-ee34-4e08-89e3-c27efd155a72","isWwObject":true},{"uid":"42b90b8e-8a7d-4b12-a8f9-fbfcf6e57214","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"row","_ww-layout_justifyContent":"flex-end"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"222c7ada-cbe6-4489-856e-4a21ec93715c":{"uid":"222c7ada-cbe6-4489-856e-4a21ec93715c","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"2b13a669-6651-4839-b6c8-3dbbf765df84":{"uid":"2b13a669-6651-4839-b6c8-3dbbf765df84","_state":{"style":{"default":{"align":"flex-end"}}},"content":{"default":{"children":[{"uid":"0209c91d-1f64-4138-afda-4f75ba4bbf93","isWwObject":true},{"uid":"def0dd34-fe7a-483b-b84c-d99ed9afcec0","isWwObject":true}],"_ww-layout_rowGap":"20px","_ww-layout_columnGap":"20px","_ww-layout_flexDirection":"row"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"bee60931-1838-4c5b-9258-fc3525cb9c5b":{"uid":"bee60931-1838-4c5b-9258-fc3525cb9c5b","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"db4e32a5-405c-4a84-b739-11218ae68bc2":{"uid":"db4e32a5-405c-4a84-b739-11218ae68bc2","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"e6677c15-bcfb-49db-adb0-8e438dd9d926":{"uid":"e6677c15-bcfb-49db-adb0-8e438dd9d926","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Semester"},"_ww-text_text":{"de":"<div>Halbjahr</div>","en":"<div>Semester</div>"},"_ww-text_color":"#334155","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Semester Label","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"ebed271a-16c8-40e9-8980-66b9689bbba3":{"uid":"ebed271a-16c8-40e9-8980-66b9689bbba3","_state":{"style":{"default":{"width":"100%","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"afc36136-402e-4cbe-9193-22ed696ef65b","isWwObject":true},{"uid":"cf9c1d7b-a2e1-4b28-b9d3-92e0a6e742fd","isWwObject":true}],"_ww-layout_rowGap":"8px","_ww-layout_columnGap":"8px","_ww-layout_flexDirection":"column"}},"name":"Description Field Group","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"57031265-b965-4391-8b3b-0314b4fe611b":{"uid":"57031265-b965-4391-8b3b-0314b4fe611b","_state":{"style":{"default":{"display":{"code":"wwFormulas.not(wwFormulas.ifEmpty(context.component?.variables?.['2c6bd0f7-f035-4093-8ec1-3c56184a6c4f']))","__wwtype":"f","defaultValue":true}}}},"content":{"default":{"children":[{"uid":"d7bbb393-7c5b-43d3-83fb-21c540403a46","isWwObject":true},{"uid":"a3e1b1aa-087a-4f1f-a33f-7db154456a70","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"a5642eb4-ed37-49a4-9e59-9f654470d508":{"uid":"a5642eb4-ed37-49a4-9e59-9f654470d508","_state":{"style":{"default":{"width":"100%","display":"flex","overflow":"auto","maxHeight":"600px"}},"states":[],"interactions":[],"dynamicConfiguration":{"content":{"children":[{"key":"label","type":"Text"},{"key":"value","type":"Text"}]}}},"content":{"default":{"children":{"code":"collections['68252bbc-8e5e-4c1a-ac8b-9ae87654e17b']?.['data']","filter":{"link":"$and","conditions":[{"field":"id","value":{"code":"context.component?.variables?.['1cc57fef-3114-43b7-addc-8649a66174eb-value']","__wwtype":"f"},"operator":"$eq","isEmptyIgnored":true}]},"__wwtype":"f","repeatable":[{"uid":"cbded39e-d143-4538-8870-dc570cdb93a0","isWwObject":true}],"defaultValue":[]},"_ww-layout_rowGap":"24px","_ww-layout_columnGap":"24px","_ww-layout_flexDirection":"column"}},"name":"Semesters Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"84f57821-4d80-427d-bc92-b287303a7baf":{"uid":"84f57821-4d80-427d-bc92-b287303a7baf","_state":{"style":{"default":{}},"states":[],"interactions":[]},"content":{"default":{"type":"modal","align":"center","overlay":true,"children":[{"uid":"0bcfe37d-03a2-4c0c-976d-47c74ecc73de","isWwObject":true}],"escClose":false,"animation":null,"sideModal":"center","sideSheet":"top","preventScroll":true,"animationEasing":"linear","customPositionX":"0%","customPositionY":"0%","slideInDirection":"top","animationDuration":300,"clickOutsideCloses":false,"overlayClickCloses":true,"overlayBackgroundColor":"rgba(0, 0, 0, 0.5)"}},"name":"Draft Selection Popup","wwObjectBaseId":"c6c0c00e-49fd-4cb9-bd78-5bc09945721e","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"d28741b6-e8e0-4493-9e8a-2d2e15f8691e":{"uid":"d28741b6-e8e0-4493-9e8a-2d2e15f8691e","_state":{},"content":{"default":{"type":"modal","align":"center","overlay":true,"children":[{"uid":"84f57821-4d80-427d-bc92-b287303a7baf","isWwObject":true}],"escClose":false,"animation":null,"sideModal":"center","sideSheet":"top","preventScroll":true,"animationEasing":"linear","customPositionX":"0%","customPositionY":"0%","slideInDirection":"top","animationDuration":300,"clickOutsideCloses":false,"overlayClickCloses":true,"overlayBackgroundColor":"rgba(0, 0, 0, 0.5)"}},"name":null,"wwObjectBaseId":"c6c0c00e-49fd-4cb9-bd78-5bc09945721e","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"0b6ad324-5ff6-49ef-95b9-211369807dfe":{"uid":"0b6ad324-5ff6-49ef-95b9-211369807dfe","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"66e4620e-107d-4c12-8fe5-824deb1f2393":{"uid":"66e4620e-107d-4c12-8fe5-824deb1f2393","_state":{"style":{"default":{"width":"16px"},"_wwHover_default":{"width":"17px"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"2d35d247-4863-4b6d-b326-d35b41ea6ac3","actions":{"abf233b6-6010-44cc-a285-e122709ca942":{"id":"abf233b6-6010-44cc-a285-e122709ca942","type":"variable","varId":"26e57ccb-b8ac-4e7a-a105-43646740ca07","internal":true,"varValue":{"code":"context.item.data","__wwtype":"f"}}},"trigger":"click","firstAction":"abf233b6-6010-44cc-a285-e122709ca942"}]},"content":{"default":{"icon":"lucide/files"}},"name":"Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"861b2345-b780-4d95-af65-c120dff41f6d":{"uid":"861b2345-b780-4d95-af65-c120dff41f6d","_state":{"style":{"default":{}}},"content":{"tablet":{},"default":{"tag":"p","bgColor":"","shadows":"","fontStyle":"ww-font-style-text","textColor":"","globalStyle":{},"_ww-text_text":{"en":"<div>Duplicate course</div>"},"transformation":"","_ww-text_nowrap":true,"_ww-text_ellipsis":false,"_ww-text_fontSize":"16px","_ww-text_sanitize":false}},"name":"Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"5f3eda99-5bae-4ded-83ef-d831853808e5":{"uid":"5f3eda99-5bae-4ded-83ef-d831853808e5","_state":{"style":{"default":{"margin":"10px 0 16px 0","display":"flex","padding":"0 0 16px 0","borderBottom":"1px solid #e2e8f0"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"15448364-b497-499c-89b2-ed139ff76e34","isWwObject":true},{"uid":"4fe9f3c3-4411-4c3c-8a1b-e966b2b07bd3","isWwObject":true}],"_ww-layout_alignItems":"center","_ww-layout_flexDirection":"row","_ww-layout_justifyContent":"space-between"}},"name":"Drafts Header","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"01b62c05-11cb-4694-8298-34b312869349":{"uid":"01b62c05-11cb-4694-8298-34b312869349","_state":{"style":{"default":{"width":"100%","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"e6677c15-bcfb-49db-adb0-8e438dd9d926","isWwObject":true},{"uid":"03eb9f3c-5920-4bcf-84f1-2f8bf7976896","isWwObject":true},{"uid":"bae9fe4b-d77f-4ac2-bfaf-3b8baf362e1a","isWwObject":true}],"_ww-layout_rowGap":"8px","_ww-layout_columnGap":"8px","_ww-layout_flexDirection":"column"}},"name":"Semester Field Group","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"0209c91d-1f64-4138-afda-4f75ba4bbf93":{"uid":"0209c91d-1f64-4138-afda-4f75ba4bbf93","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"12px 24px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#F6613C"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#F74418"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"aaf8ee74-7e8e-496a-af13-d598ceee7efb","actions":{"e4e99ba5-e3b8-41e5-af82-0630d0b436d6":{"id":"e4e99ba5-e3b8-41e5-af82-0630d0b436d6","next":null,"type":"reset-variables","varsId":["2c6bd0f7-f035-4093-8ec1-3c56184a6c4f"]}},"trigger":"click","firstAction":"e4e99ba5-e3b8-41e5-af82-0630d0b436d6"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"b6caac88-c6a8-4ea0-a941-be692891b32b","isWwObject":true},"rightIcon":{"uid":"57230662-7e2b-4d3a-b98c-c855d62e98b1","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","de":"<div>Abrechnen</div>","en":"<div>Cancel</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"04900701-c5b8-4a6d-9bc6-3ea108864698":{"uid":"04900701-c5b8-4a6d-9bc6-3ea108864698","_state":{"style":{"default":{}}},"content":{"default":{"validation":"submit","formContent":[{"uid":"f8de6f1e-9cf5-4355-afee-b28b4ea985f7","isWwObject":true},{"uid":"9b01d1ae-a031-431c-8458-1dcd15cc8122","isWwObject":true},{"uid":"ddd2e270-f431-45be-97aa-050b3c6f79c1","isWwObject":true},{"uid":"0fab93fe-7255-46c0-a342-be0b00e24619","isWwObject":true}],"autocomplete":true,"debounceDelay":"500ms","_ww-layout_rowGap":"16px"}},"name":"Form container","wwObjectBaseId":"9ecb2cfc-cef7-4be8-b736-3e17a3b7e9ff","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"0633cc2f-8aa1-44f5-b3a7-8e2cf24bee52":{"uid":"0633cc2f-8aa1-44f5-b3a7-8e2cf24bee52","_state":{"style":{"default":{"margin":"4px 0 0 0","display":{"code":"return !variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.name && variables['form_touched'] ? 'block' : 'none'","__wwtype":"js"}}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Please enter a draft name"},"_ww-text_text":{"en":"Please enter a draft name"},"_ww-text_color":"#ef4444","_ww-text_fontSize":"14px","_ww-text_fontWeight":"400"}},"name":"Name Error","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"0bcfe37d-03a2-4c0c-976d-47c74ecc73de":{"uid":"0bcfe37d-03a2-4c0c-976d-47c74ecc73de","_state":{"style":{"default":{"width":"600px","display":"flex","padding":"32px","position":"relative","boxShadow":"0 25px 50px -12px rgba(0, 0, 0, 0.25)","borderRadius":"16px","backgroundColor":"#ffffff"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"fbc0cc5f-8f25-413d-9e1b-9205c032b2be","isWwObject":true},{"uid":"57031265-b965-4391-8b3b-0314b4fe611b","isWwObject":true},{"uid":"e4f8e64e-7688-4a18-b9ba-764efe0a4d29","isWwObject":true},{"uid":"12827b03-65a3-433e-aa23-f8ee42ee712c","isWwObject":true},{"uid":"0a25cfbd-79b3-47cc-b0f9-1548a8bd4269","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":"Draft Selection Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"13283cb0-d7fc-42bf-8cce-9ac432c16692":{"uid":"13283cb0-d7fc-42bf-8cce-9ac432c16692","_state":{"style":{"default":{"width":"100%","border":"1px solid #cbd5e1","height":"48px","padding":"0 16px","customCss":{"outline":"none"},"transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#ffffff"},"_wwFocus_default":{"boxShadow":"0 0 0 2px rgba(59, 130, 246, 0.2)","customCss":{"border-color":"#3b82f6"}},"_wwHover_default":{"customCss":{"border-color":"#94a3b8"}}},"states":[],"interactions":[]},"content":{"default":{"max":"10000","min":"0","rows":4,"step":1,"type":"text","value":{"code":"return variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.name || ''","__wwtype":"js"},"resize":false,"maxDate":"","minDate":"","debounce":false,"readonly":false,"required":true,"fieldName":"","precision":"0.1","hideArrows":false,"validation":"","placeholder":{"de":"Entwurfstitel eingeben","en":"Enter draft name"},"autocomplete":false,"debounceDelay":"500ms","timePrecision":1,"_ww-text_color":"#334155","currencySymbol":"$","displayPassword":false,"customValidation":false,"_ww-text_fontSize":"16px","currencyShowSymbol":true,"currencySymbolColor":"#666666","currencyDecimalPlaces":2,"currencySymbolPadding":"4px","currencySymbolFontSize":"1em","currencySymbolPosition":"prefix","currencyDecimalSeparator":".","currencyThousandsSeparator":","},"_wwFocus_default":{},"_wwHover_default":{}},"name":"Name Input","wwObjectBaseId":"deb10a01-5eef-4aa1-9017-1b51c2ad6fd0","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"15448364-b497-499c-89b2-ed139ff76e34":{"uid":"15448364-b497-499c-89b2-ed139ff76e34","_state":{"style":{"default":{"margin":"0","animationDuration":"800ms","animationFillMode":"both","animationKeyframes":"@keyframes slideInFromLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }","animationIterationCount":"1","animationTimingFunction":"ease-out"}},"states":[],"interactions":[]},"content":{"default":{"tag":"h2","text":{"en":"Saved Drafts"},"_ww-text_text":{"en":"Saved Drafts"},"_ww-text_color":"#1e293b","_ww-text_fontSize":"24px","_ww-text_fontWeight":"600"}},"name":"Drafts Title","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"1cc57fef-3114-43b7-addc-8649a66174eb":{"uid":"1cc57fef-3114-43b7-addc-8649a66174eb","_state":{"style":{"default":{"width":"320px"}}},"content":{"default":{"side":"bottom","align":"start","choices":{"code":"collections['68252bbc-8e5e-4c1a-ac8b-9ae87654e17b']?.['data']","__wwtype":"f"},"offsetX":"0px","offsetY":"8px","disabled":false,"readonly":false,"required":false,"autoFocus":true,"fieldName":"","chipBorder":{"code":"[{\"label\":\"Option 1\",\"value\":\"opt1\"},{\"label\":\"Option 2\",\"value\":\"opt2\"}]","__wwtype":"f"},"optionIcon":null,"selectType":"single","showSearch":false,"validation":"","zIndexOpen":2,"boundOffset":"0px","chipBgColor":"#363636","chipPadding":"2px 8px","placeholder":{"de":"Halbjahr","en":"Semester"},"searchWidth":"100%","chipFontSize":"14px","chipIconSize":"14px","initialState":"closed","mappingLabel":{"code":"context.mapping?.['name']","type":"f"},"mappingValue":{"code":"context.mapping?.['id']","type":"f"},"optionCursor":"pointer","searchBorder":false,"searchMargin":"0px 0px 8px 0px","chipFontColor":"white","chipIconColor":"white","closeOnSelect":true,"dropdownWidth":{"code":"context.local.data?.['select']?.['select']?.['utils']?.['triggerWidth']+'px'","__wwtype":"f"},"manualTrigger":false,"optionBgColor":"white","optionPadding":"8px","optionSpacing":"0px","searchBgColor":"#FAFAFA","searchPadding":"8px 12px","selectOnClick":true,"triggerBorder":false,"triggerMargin":"0px","chipFontWeight":null,"dropdownBorder":false,"emptyStateText":{"en":"No results found","fr":"Aucun rsultat trouv"},"optionFontSize":"14px","optionIconSize":"12px","triggerBgColor":"white","triggerPadding":"8px 8px","triggerShadows":"","dropdownBgColor":"#FFFFFF","dropdownPadding":"8px","dropdownShadows":"","initValueSingle":null,"mappingDisabled":{"code":"false","type":"f"},"optionFontColor":"black","optionIconColor":"black","searchBorderAll":"1px solid #A3A3A3","searchFontColor":"black","triggerIconOpen":null,"triggerIconSize":"16px","unselectOnClick":false,"chipBorderRadius":"4px","customValidation":false,"optionFontWeight":null,"searchFontWeight":null,"selectedFontSize":"14px","triggerBorderAll":"1px solid #B0B0B0","triggerIconClose":null,"triggerIconColor":"black","dropdownBorderAll":"1px solid #B0B0B0","emptyStatePadding":"0px","searchPlaceholder":{"en":"Search","fr":"Rechercher"},"selectedFontColor":"#333","selectedTextAlign":"left","emptyStateFontSize":"14px","optionBgColorHover":"#f5f5f5","optionBorderRadius":"4px","searchBorderRadius":"4px","selectedFontWeight":null,"closeOnClickOutside":true,"emptyStateFontColor":"black","emptyStateTextAlign":"center","placeholderFontSize":"14px","triggerBorderRadius":"4px","virtualScrollBuffer":600,"dropdownBorderRadius":"4px","emptyStateFontWeight":null,"optionBgColorFocused":"#f5f5f5","placeholderFontColor":"#333","placeholderTextAlign":"left","placeholderFontWeight":null,"allowScrollingWhenOpen":false,"searchPlaceholderColor":"#737373","virtualScrollMinItemSize":40}},"name":"Select semester","wwObjectBaseId":"6145eb60-0af8-4e52-bcc6-dc0f6743654e","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"2528e941-1ba7-4cc3-969a-3b91f7141efd":{"uid":"2528e941-1ba7-4cc3-969a-3b91f7141efd","_state":{"style":{"default":{"width":"18px","height":"auto"}},"states":[],"interactions":[]},"content":{"default":{"icon":"lucide/file-text","color":"#0284c7"}},"name":"Drafts Count Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"2a64ba8d-a754-4e7d-b9a4-0c5d9fb2d685":{"uid":"2a64ba8d-a754-4e7d-b9a4-0c5d9fb2d685","_state":{"style":{"default":{"width":"100%","zIndex":null,"display":"flex"}},"states":[],"interactions":[],"dynamicConfiguration":{"content":{"children":[{"key":"label","type":"Text"},{"key":"value","type":"Text"}]}}},"content":{"default":{"children":{"code":"collections['06961c10-9632-4582-9f15-bb9ba8e53d61']?.['data']","sort":[{"key":"updated_at","direction":"DESC"}],"filter":{"link":"$and","conditions":[{"field":"semester_id","value":{"code":"context.item.data?.['id']","__wwtype":"f"},"operator":"$eq"},{"field":"created_by","value":{"code":"return context.component?.variables?.[/* select creator - value */ '6ccc16a6-fa2d-46a5-b004-7e87f28d00a5-value']","__wwtype":"js"},"operator":"$eq","isEmptyIgnored":true}]},"__wwtype":"f","repeatable":[{"uid":"b7c6496a-f1c7-44df-b591-1c639b757ade","isWwObject":true}],"defaultValue":[]},"_ww-layout_rowGap":"12px","_ww-layout_columnGap":"12px","_ww-layout_flexDirection":"column"}},"name":"Drafts List","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"2d7c72c7-714b-4fb7-adb5-07fbc131ab67":{"uid":"2d7c72c7-714b-4fb7-adb5-07fbc131ab67","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"3d95877b-bd27-4205-88d0-147f28ebef41":{"uid":"3d95877b-bd27-4205-88d0-147f28ebef41","_state":{"style":{"default":{"margin":"0 0 8px 0","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"aefd7517-5806-47b9-a2d6-0962b154c443","isWwObject":true},{"uid":"8d7467c0-bdcc-4d05-8cb3-fc7c5baf750f","isWwObject":true}],"_ww-layout_rowGap":"8px","_ww-layout_columnGap":"8px","_ww-layout_flexDirection":"column"}},"name":"Form Header","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"43cb4ab7-e582-484f-9ea3-7e71862f6e15":{"uid":"43cb4ab7-e582-484f-9ea3-7e71862f6e15","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"450f60a5-ff47-4eda-b4f1-9e8974721fb8":{"uid":"450f60a5-ff47-4eda-b4f1-9e8974721fb8","_state":{"style":{"default":{"border":"1px solid #E0E0E0","height":"36px","margin":"0px 0px 0px 0px","padding":"8px","borderRadius":"8px","backgroundColor":"#FFFFFF"}}},"content":{"default":{"max":10000,"min":0,"cols":10,"rows":4,"step":1,"type":"text","color":"#000000","value":{"code":"context.item.data?.['title']","__wwtype":"f","defaultValue":""},"resize":false,"maxDate":"","minDate":"","debounce":false,"fontSize":"15px","readonly":false,"required":true,"fieldName":"","isTooltip":true,"precision":"0.1","fontFamily":"","hideArrows":false,"transition":"500ms","validation":"","placeholder":{"de":"Entwurfname","en":"Draft name"},"autocomplete":false,"debounceDelay":"500ms","timePrecision":1,"currencySymbol":"$","forceAnimation":false,"timingFunction":"cubic-bezier(0, 1.08, 0.76, 1)","displayPassword":false,"animationTrigger":"input","customValidation":false,"placeholderColor":"#000000ad","_ww-text_ellipsis":false,"_ww-text_fontSize":"14px","_ww-text_sanitize":false,"currencyShowSymbol":true,"placeholderElement":null,"placeholderScaling":0.8,"advancedPlaceholder":false,"currencySymbolColor":"#666666","placeholderPosition":"outside","positioningAjustment":"0px","currencyDecimalPlaces":2,"currencySymbolPadding":"4px","currencySymbolFontSize":"1em","currencySymbolPosition":"prefix","currencyDecimalSeparator":".","currencyThousandsSeparator":","}},"name":"Input draft title","wwObjectBaseId":"deb10a01-5eef-4aa1-9017-1b51c2ad6fd0","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"49064997-d256-4419-92a6-6bc2e3da601e":{"uid":"49064997-d256-4419-92a6-6bc2e3da601e","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":{"code":"return Object.values(variables['14d73ea3-4b0e-416c-a860-27a047e5fd64']).flat().length + ' drafts'","__wwtype":"js"}},"_ww-text_text":{"en":{"code":"const count = collections['06961c10-9632-4582-9f15-bb9ba8e53d61']?.['total'] || 0;\r\nreturn count + (count === 1 ? ' draft' : ' drafts');\r\n","__wwtype":"js"}},"_ww-text_color":"#0284c7","_ww-text_fontSize":"14px","_ww-text_fontWeight":"500"}},"name":"Drafts Count Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"4b1e5ef7-b48d-4605-b6a7-17641bb6bae9":{"uid":"4b1e5ef7-b48d-4605-b6a7-17641bb6bae9","_state":{"style":{"default":{"border":"1px solid #E0E0E0","height":"36px","margin":"0px 0px 0px 0px","padding":"8px","borderRadius":"8px","backgroundColor":"#FFFFFF"}}},"content":{"default":{"max":10000,"min":0,"cols":10,"rows":4,"step":1,"type":"text","color":"#000000","value":"","resize":false,"maxDate":"","minDate":"","debounce":false,"fontSize":"15px","readonly":false,"required":true,"fieldName":"","isTooltip":true,"precision":"0.1","fontFamily":"","hideArrows":false,"transition":"500ms","validation":"","placeholder":{"de":"Entwurfname","en":"Draft name"},"autocomplete":false,"debounceDelay":"500ms","timePrecision":1,"currencySymbol":"$","forceAnimation":false,"timingFunction":"cubic-bezier(0, 1.08, 0.76, 1)","displayPassword":false,"animationTrigger":"input","customValidation":false,"placeholderColor":"#000000ad","_ww-text_ellipsis":false,"_ww-text_fontSize":"14px","_ww-text_sanitize":false,"currencyShowSymbol":true,"placeholderElement":null,"placeholderScaling":0.8,"advancedPlaceholder":false,"currencySymbolColor":"#666666","placeholderPosition":"outside","positioningAjustment":"0px","currencyDecimalPlaces":2,"currencySymbolPadding":"4px","currencySymbolFontSize":"1em","currencySymbolPosition":"prefix","currencyDecimalSeparator":".","currencyThousandsSeparator":","}},"name":"Input name duplicate","wwObjectBaseId":"deb10a01-5eef-4aa1-9017-1b51c2ad6fd0","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"4fe9f3c3-4411-4c3c-8a1b-e966b2b07bd3":{"uid":"4fe9f3c3-4411-4c3c-8a1b-e966b2b07bd3","_state":{"style":{"default":{"display":"flex","padding":"6px 12px","borderRadius":"16px","animationDelay":"200ms","backgroundColor":"#e0f2fe","animationDuration":"800ms","animationFillMode":"both","animationKeyframes":"@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }","animationIterationCount":"1","animationTimingFunction":"ease-out"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"2528e941-1ba7-4cc3-969a-3b91f7141efd","isWwObject":true},{"uid":"49064997-d256-4419-92a6-6bc2e3da601e","isWwObject":true}],"_ww-layout_rowGap":"8px","_ww-layout_columnGap":"8px","_ww-layout_alignItems":"center","_ww-layout_flexDirection":"row"}},"name":"Drafts Count Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"563975e4-07c4-4068-b78f-664538b8caac":{"uid":"563975e4-07c4-4068-b78f-664538b8caac","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"57230662-7e2b-4d3a-b98c-c855d62e98b1":{"uid":"57230662-7e2b-4d3a-b98c-c855d62e98b1","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"67afd335-d2d3-49ae-8fe3-a9dab45575de":{"uid":"67afd335-d2d3-49ae-8fe3-a9dab45575de","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"684cacbf-57f9-47e0-b80a-03709982a0a4":{"uid":"684cacbf-57f9-47e0-b80a-03709982a0a4","_state":{"style":{"default":{}}},"content":{"default":{"validation":"submit","formContent":[{"uid":"861b2345-b780-4d95-af65-c120dff41f6d","isWwObject":true},{"uid":"4b1e5ef7-b48d-4605-b6a7-17641bb6bae9","isWwObject":true},{"uid":"8b5be73e-c884-46f1-91ec-6227b4374c42","isWwObject":true}],"autocomplete":true,"debounceDelay":"500ms","_ww-layout_rowGap":"16px"}},"name":"Form container","wwObjectBaseId":"9ecb2cfc-cef7-4be8-b736-3e17a3b7e9ff","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"75409c39-15a2-4ebd-a5b6-1b17e19f99b6":{"uid":"75409c39-15a2-4ebd-a5b6-1b17e19f99b6","_state":{"style":{"default":{"width":"17px","border":"1px solid ","padding":"1px","borderRadius":"3px"}},"interactions":[{"id":"2d35d247-4863-4b6d-b326-d35b41ea6ac3","actions":{"abf233b6-6010-44cc-a285-e122709ca942":{"id":"abf233b6-6010-44cc-a285-e122709ca942","type":"variable","varId":"d4def191-54aa-4a6b-b1d3-b5ead5da62e7","internal":true,"varValue":{"code":"context.item.data","__wwtype":"f"}}},"trigger":"click","firstAction":"abf233b6-6010-44cc-a285-e122709ca942"}]},"content":{"default":{"icon":"lucide/pen"}},"name":"Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"75d22851-2087-4529-b657-ab3b11602ae2":{"uid":"75d22851-2087-4529-b657-ab3b11602ae2","_state":{"style":{"default":{"margin":"0 0 8px 0","zIndex":null,"display":"flex"},"_wwHover_default":{"display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"cfc0a156-f978-454d-97fb-5348af2f9ae6","isWwObject":true},{"uid":"7fed90ee-dac2-41f3-b45b-b5352e412bcc","isWwObject":true}],"_ww-layout_alignItems":"center","_ww-layout_flexDirection":"row","_ww-layout_justifyContent":"space-between"},"_wwHover_default":{}},"name":"Draft Header","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"7e593784-ea53-48af-a9ff-2601a2027923":{"uid":"7e593784-ea53-48af-a9ff-2601a2027923","_state":{"style":{"default":{"margin":"0"},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":{"code":"context.item.data.id","__wwtype":"f"}},"_ww-text_text":{"de":{"code":"const savedAt = context.item.data?.['updated_at'];\r\nif (!savedAt) return 'Zuletzt gespeichert: nie';\r\n\r\nconst date = new Date(savedAt);\r\nconst dd = String(date.getDate()).padStart(2, '0');\r\nconst mm = String(date.getMonth() + 1).padStart(2, '0');\r\nconst yyyy = date.getFullYear();\r\nconst hh = String(date.getHours()).padStart(2, '0');\r\nconst min = String(date.getMinutes()).padStart(2, '0');\r\n\r\nreturn `Zuletzt gespeichert: ${dd}.${mm}.${yyyy} ${hh}:${min}`;\r\n","__wwtype":"js"},"en":{"code":"const savedAt = context.item.data?.['updated_at'];\r\nif (!savedAt) return 'Last saved: never';\r\n\r\nconst date = new Date(savedAt);\r\nconst dd = String(date.getDate()).padStart(2, '0');\r\nconst mm = String(date.getMonth() + 1).padStart(2, '0');\r\nconst yyyy = date.getFullYear();\r\nconst hh = String(date.getHours()).padStart(2, '0');\r\nconst min = String(date.getMinutes()).padStart(2, '0');\r\n\r\nreturn `Last saved: ${dd}.${mm}.${yyyy} ${hh}:${min}`;","__wwtype":"js"}},"_ww-text_color":"#64748b","_ww-text_fontSize":"12px","_ww-text_fontWeight":"500"},"_wwHover_default":{}},"name":"Draft ID Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"7fed90ee-dac2-41f3-b45b-b5352e412bcc":{"uid":"7fed90ee-dac2-41f3-b45b-b5352e412bcc","_state":{"style":{"default":{"display":"flex","padding":"4px 8px","borderRadius":"12px","backgroundColor":"#f1f5f9"},"_wwHover_default":{"display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"7e593784-ea53-48af-a9ff-2601a2027923","isWwObject":true},{"uid":"6aa0fc66-090e-48d2-971b-da51087103c5","isWwObject":true},{"uid":"dcacf3e0-60e1-4ed3-946f-9060676639c5","isWwObject":true}],"_ww-layout_rowGap":"6px","_ww-layout_columnGap":"6px","_ww-layout_alignItems":"center","_ww-layout_flexDirection":"row"},"_wwHover_default":{}},"name":"Draft ID Badge","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"81b9b6b4-3ab2-4455-9658-19fcb2a65f85":{"uid":"81b9b6b4-3ab2-4455-9658-19fcb2a65f85","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"84d1c7a6-bffc-49d0-9911-8e916e32cb74":{"uid":"84d1c7a6-bffc-49d0-9911-8e916e32cb74","_state":{"style":{"default":{"width":"20px","height":"auto","margin":"0 8px 0 0"},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"icon":"lucide/file-search","color":"#ffffff"},"_wwHover_default":{}},"name":"Load Previous Draft Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"885b56a4-2a61-4d70-89ec-a4593f7d8549":{"uid":"885b56a4-2a61-4d70-89ec-a4593f7d8549","_state":{"style":{"default":{"flex":"0 1 auto","border":"1px solid #E0E0E0","height":"36px","margin":"0px 0px 0px 0px","padding":"8px","minHeight":"80px","textAlign":null,"borderRadius":"8px","backgroundColor":"#FFFFFF"}}},"content":{"default":{"max":10000,"min":0,"cols":10,"rows":4,"step":1,"type":"textarea","color":"#000000","value":{"code":"context.item.data?.['notes']","__wwtype":"f","defaultValue":""},"resize":true,"maxDate":"","minDate":"","debounce":false,"fontSize":"15px","readonly":false,"required":false,"fieldName":"","isTooltip":true,"precision":"0.1","fontFamily":"","hideArrows":false,"transition":"500ms","validation":"","placeholder":{"en":"Placeholder"},"autocomplete":false,"debounceDelay":"500ms","timePrecision":1,"currencySymbol":"$","forceAnimation":false,"timingFunction":"cubic-bezier(0, 1.08, 0.76, 1)","displayPassword":false,"animationTrigger":"input","customValidation":false,"placeholderColor":"#000000ad","_ww-text_ellipsis":false,"_ww-text_fontSize":"14px","_ww-text_sanitize":false,"currencyShowSymbol":true,"placeholderElement":null,"placeholderScaling":0.8,"advancedPlaceholder":false,"currencySymbolColor":"#666666","placeholderPosition":"outside","positioningAjustment":"0px","currencyDecimalPlaces":2,"currencySymbolPadding":"4px","currencySymbolFontSize":"1em","currencySymbolPosition":"prefix","currencyDecimalSeparator":".","currencyThousandsSeparator":","}},"name":"Input draft description","wwObjectBaseId":"deb10a01-5eef-4aa1-9017-1b51c2ad6fd0","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"8b5be73e-c884-46f1-91ec-6227b4374c42":{"uid":"8b5be73e-c884-46f1-91ec-6227b4374c42","_state":{"style":{}},"content":{"default":{"children":[{"uid":"b77a8f9b-e942-4ab7-904d-74af9ddeab1e","isWwObject":true},{"uid":"5b30a123-d361-4503-89b9-6e06bc7c6e47","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"row","_ww-layout_justifyContent":"flex-end"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"8d7467c0-bdcc-4d05-8cb3-fc7c5baf750f":{"uid":"8d7467c0-bdcc-4d05-8cb3-fc7c5baf750f","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Fill in the details below to create a new draft. Your changes will be automatically saved."},"_ww-text_text":{"de":"<div>Flle die folgenden Felder aus, um einen neuen Entwurf zu erstellen. Deine nderungen werden automatisch gespeichert.</div>","en":"<div>Fill in the details below to create a new draft. Your changes will be automatically saved.</div>"},"_ww-text_color":"#64748b","_ww-text_fontSize":"16px","_ww-text_fontWeight":"400"}},"name":"Form Subtitle","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"9b01d1ae-a031-431c-8458-1dcd15cc8122":{"uid":"9b01d1ae-a031-431c-8458-1dcd15cc8122","_state":{"style":{}},"content":{"default":{"children":[{"uid":"cfb39d83-e94b-45eb-9173-7136efd6cd0a","isWwObject":true},{"uid":"450f60a5-ff47-4eda-b4f1-9e8974721fb8","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"9ea101f5-81f6-4b36-a413-911dbf104434":{"uid":"9ea101f5-81f6-4b36-a413-911dbf104434","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"9fe852cc-17c3-4959-ba45-b28507469192":{"uid":"9fe852cc-17c3-4959-ba45-b28507469192","_state":{"style":{"default":{"display":{"code":"context.component?.variables?.['2c6bd0f7-f035-4093-8ec1-3c56184a6c4f']==\"load\"","__wwtype":"f","defaultValue":true}}}},"content":{"default":{"children":[{"uid":"5f3eda99-5bae-4ded-83ef-d831853808e5","isWwObject":true},{"uid":"a6b498b9-316c-4f63-96de-9870001dd9f4","isWwObject":true},{"uid":"a5642eb4-ed37-49a4-9e59-9f654470d508","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"a29cdf6d-abf6-4bfb-9bfa-2a5c1f720f77":{"uid":"a29cdf6d-abf6-4bfb-9bfa-2a5c1f720f77","_state":{"style":{"default":{"width":"100%","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"01b62c05-11cb-4694-8298-34b312869349","isWwObject":true},{"uid":"e275e659-dcad-4781-8af2-b68f19f379d9","isWwObject":true},{"uid":"ebed271a-16c8-40e9-8980-66b9689bbba3","isWwObject":true}],"_ww-layout_rowGap":"24px","_ww-layout_columnGap":"24px","_ww-layout_flexDirection":"column"}},"name":"Form Fields","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"a2ce0820-134e-4dff-bd73-37330c073944":{"uid":"a2ce0820-134e-4dff-bd73-37330c073944","_state":{"style":{"default":{"left":"-438px","width":"400px","border":"1px solid #8A8A8A","bottom":"-86px","cursor":"default","zIndex":100,"display":{"code":"wwFormulas.getKeyValue(context.component?.variables?.['d4def191-54aa-4a6b-b1d3-b5ead5da62e7'],\"id\")==context.item.data?.['id']","__wwtype":"f","defaultValue":"flex"},"padding":"12px","overflow":"visible","position":"absolute","boxShadow":"0px 0px 10px 1px #A6A6A6","borderRadius":"12px","backgroundColor":"#FFFFFF"}}},"content":{"default":{"children":[{"uid":"04900701-c5b8-4a6d-9bc6-3ea108864698","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"column"}},"name":"Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"a3e1b1aa-087a-4f1f-a33f-7db154456a70":{"uid":"a3e1b1aa-087a-4f1f-a33f-7db154456a70","_state":{"style":{"default":{"width":"100%","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"63f880ea-5252-4799-8eb0-39813f385b80","isWwObject":true},{"uid":"8f44d103-2fc4-4aa2-ac2f-2d67d958c484","isWwObject":true}],"_ww-layout_rowGap":"16px","_ww-layout_columnGap":"16px","_ww-layout_flexDirection":"column"}},"name":"Draft Selection Options","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"a6b498b9-316c-4f63-96de-9870001dd9f4":{"uid":"a6b498b9-316c-4f63-96de-9870001dd9f4","_state":{"style":{"default":{"margin":"0 0 10px 0"}}},"content":{"default":{"children":[{"uid":"6ccc16a6-fa2d-46a5-b004-7e87f28d00a5","isWwObject":true},{"uid":"1cc57fef-3114-43b7-addc-8649a66174eb","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"row"}},"name":"Filters ","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"aefd7517-5806-47b9-a2d6-0962b154c443":{"uid":"aefd7517-5806-47b9-a2d6-0962b154c443","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"h1","text":{"en":"Create New Draft"},"_ww-text_text":{"de":"<div>Neuen Entwurf erstellen</div>","en":"<div>Create New Draft</div>"},"_ww-text_color":"#1e293b","_ww-text_fontSize":"28px","_ww-text_fontWeight":"700"}},"name":"Form Title","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"afc36136-402e-4cbe-9193-22ed696ef65b":{"uid":"afc36136-402e-4cbe-9193-22ed696ef65b","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Description / Notes"},"_ww-text_text":{"de":"<div>Beschreibung / Notizen</div>","en":"Description / Notes"},"_ww-text_color":"#334155","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Description Label","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"b03a15a9-df62-4273-82e9-5b5b01d2dce3":{"uid":"b03a15a9-df62-4273-82e9-5b5b01d2dce3","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"b54e0b85-dcb0-4898-b96a-26cdb47b0fcf":{"uid":"b54e0b85-dcb0-4898-b96a-26cdb47b0fcf","_state":{"style":{"default":{"width":"20px","margin":"0 0 0 6px"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"b6c886ae-f810-43b7-ae9a-811f328353b4":{"uid":"b6c886ae-f810-43b7-ae9a-811f328353b4","_state":{"style":{"default":{"zIndex":null}}},"content":{"default":{"children":[{"uid":"f58ff2be-2ec7-4fb4-90c9-632cf333bf29","isWwObject":true},{"uid":"d0f87df5-ce96-49ba-9a99-bd4122252610","isWwObject":true}],"_ww-layout_flexDirection":"row","_ww-layout_justifyContent":"space-between"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"b6caac88-c6a8-4ea0-a941-be692891b32b":{"uid":"b6caac88-c6a8-4ea0-a941-be692891b32b","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"bae9fe4b-d77f-4ac2-bfaf-3b8baf362e1a":{"uid":"bae9fe4b-d77f-4ac2-bfaf-3b8baf362e1a","_state":{"style":{"default":{"margin":"4px 0 0 0","display":{"code":"return !variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.semester && variables['form_touched'] ? 'block' : 'none'","__wwtype":"js"}}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Please select a semester"},"_ww-text_text":{"en":"Please select a semester"},"_ww-text_color":"#ef4444","_ww-text_fontSize":"14px","_ww-text_fontWeight":"400"}},"name":"Semester Error","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"c2ba69fb-347e-40a0-b60b-37de6fb4d271":{"uid":"c2ba69fb-347e-40a0-b60b-37de6fb4d271","_state":{"style":{"default":{"margin":"0 0 8px 0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"h2","text":{"en":"Draft Options"},"_ww-text_text":{"de":"<div>Entwurfsoptionen</div>","en":"Draft Options"},"_ww-text_color":"#334155","_ww-text_fontSize":"24px","_ww-text_textAlign":"center","_ww-text_fontWeight":"700"}},"name":"Draft Selection Title","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"c6070bdb-dd46-43a8-8e86-db4c2e8d283c":{"uid":"c6070bdb-dd46-43a8-8e86-db4c2e8d283c","_state":{"style":{"default":{"width":"20px","height":"auto","margin":"0 8px 0 0"},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"icon":"lucide/file-plus","color":"#334155"},"_wwHover_default":{}},"name":"Start New Draft Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"cbded39e-d143-4538-8870-dc570cdb93a0":{"uid":"cbded39e-d143-4538-8870-dc570cdb93a0","_state":{"style":{"default":{"width":"100%","display":"flex","animationDelay":{"code":"context.item.index * 150 + 'ms'","__wwtype":"f"},"animationDuration":"600ms","animationFillMode":"both","animationKeyframes":"@keyframes slideInFromRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }","animationIterationCount":"1","animationTimingFunction":"ease-out"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"a0864d9d-f95e-4383-8235-7a0a14ad1ab1","isWwObject":true},{"uid":"2a64ba8d-a754-4e7d-b9a4-0c5d9fb2d685","isWwObject":true}],"_ww-layout_rowGap":"16px","_ww-layout_columnGap":"16px","_ww-layout_flexDirection":"column"}},"name":"Semester Group","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"cc3710ae-29ee-40a5-a13a-9f45845017c2":{"uid":"cc3710ae-29ee-40a5-a13a-9f45845017c2","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"cf9c1d7b-a2e1-4b28-b9d3-92e0a6e742fd":{"uid":"cf9c1d7b-a2e1-4b28-b9d3-92e0a6e742fd","_state":{"style":{"default":{"width":"100%","border":"1px solid #cbd5e1","padding":"12px 16px","customCss":{"outline":"none"},"transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#ffffff"},"_wwFocus_default":{"boxShadow":"0 0 0 2px rgba(59, 130, 246, 0.2)","customCss":{"border-color":"#3b82f6"}},"_wwHover_default":{"customCss":{"border-color":"#94a3b8"}}},"states":[],"interactions":[]},"content":{"default":{"max":"10000","min":"0","rows":5,"step":1,"type":"textarea","value":{"code":"return variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.description || ''","__wwtype":"js"},"resize":true,"maxDate":"","minDate":"","debounce":false,"readonly":false,"required":false,"fieldName":"","precision":"0.1","hideArrows":false,"validation":"","placeholder":{"de":"Beschreibung oder Notizen zum Entwurf eingeben","en":"Enter draft description or notes"},"autocomplete":false,"debounceDelay":"500ms","timePrecision":1,"_ww-text_color":"#334155","currencySymbol":"$","displayPassword":false,"customValidation":false,"_ww-text_fontSize":"16px","currencyShowSymbol":true,"_ww-text_fontFamily":"inherit","currencySymbolColor":"#666666","currencyDecimalPlaces":2,"currencySymbolPadding":"4px","currencySymbolFontSize":"1em","currencySymbolPosition":"prefix","currencyDecimalSeparator":".","currencyThousandsSeparator":","},"_wwFocus_default":{},"_wwHover_default":{}},"name":"Description Input","wwObjectBaseId":"deb10a01-5eef-4aa1-9017-1b51c2ad6fd0","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"cfb39d83-e94b-45eb-9173-7136efd6cd0a":{"uid":"cfb39d83-e94b-45eb-9173-7136efd6cd0a","_state":{"style":{"default":{}}},"content":{"tablet":{},"default":{"tag":"p","bgColor":"","shadows":"","fontStyle":"ww-font-style-text","textColor":"","globalStyle":{},"_ww-text_text":{"en":"<div>Title</div>"},"transformation":"","_ww-text_ellipsis":false,"_ww-text_fontSize":"16px","_ww-text_sanitize":false,"_ww-text_fontWeight":600}},"name":"Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"cfc0a156-f978-454d-97fb-5348af2f9ae6":{"uid":"cfc0a156-f978-454d-97fb-5348af2f9ae6","_state":{"style":{"default":{"margin":"0"},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"tag":"h4","text":{"en":{"code":"context.item.data.name","__wwtype":"f"}},"_ww-text_text":{"en":{"code":"context.item.data?.['title']","__wwtype":"f"}},"_ww-text_color":"#1e293b","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"},"_wwHover_default":{}},"name":"Draft Name","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"d0f87df5-ce96-49ba-9a99-bd4122252610":{"uid":"d0f87df5-ce96-49ba-9a99-bd4122252610","_state":{"style":{"default":{"margin":"0","display":{"code":"context.item.data?.['is_live']","__wwtype":"f","defaultValue":true},"boxShadow":null},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":{"code":"return context.item.data.description || 'No description available'","__wwtype":"js"}},"_ww-text_text":{"en":"<div> Live</div>"},"_ww-text_color":"#18E71C","_ww-text_fontSize":"14px","_ww-text_fontWeight":600,"_ww-text_lineHeight":"1.5","_ww-text_textShadow":"0px 0px 6px #61FA63"},"_wwHover_default":{}},"name":"Draft Description","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"d7bbb393-7c5b-43d3-83fb-21c540403a46":{"uid":"d7bbb393-7c5b-43d3-83fb-21c540403a46","_state":{"style":{"default":{"margin":"0 0 32px 0","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"c2ba69fb-347e-40a0-b60b-37de6fb4d271","isWwObject":true},{"uid":"ed14230b-803b-4d45-90f3-e2a4d3db6d57","isWwObject":true}],"_ww-layout_alignItems":"center","_ww-layout_flexDirection":"column"}},"name":"Draft Selection Header","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"d7c77ec1-bae5-48e7-b1cc-2ac5f901f8bc":{"uid":"d7c77ec1-bae5-48e7-b1cc-2ac5f901f8bc","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"h3","text":{"en":{"code":"context.item.data","__wwtype":"f"}},"_ww-text_text":{"en":{"code":"const startYear = new Date(context.item.data?.['start_date']).getFullYear();\r\nconst endYear = new Date(context.item.data?.['end_date']).getFullYear();\r\nconst label = context.item.data?.['name'] || '';\r\n\r\nreturn `${startYear}/${endYear} ${label}`;\r\n","__wwtype":"js"}},"_ww-text_color":"#475569","_ww-text_fontSize":"18px","_ww-text_fontWeight":"600"}},"name":"Semester Title","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"db80cec7-2a20-4a99-aca2-74ac0f6aabd8":{"uid":"db80cec7-2a20-4a99-aca2-74ac0f6aabd8","_state":{"style":{"default":{"width":"20px","margin":"0 6px 0 0"}}},"content":{"default":{"icon":"lucide/plus","color":"#FFFFFF"}},"name":null,"wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"dcacf3e0-60e1-4ed3-946f-9060676639c5":{"uid":"dcacf3e0-60e1-4ed3-946f-9060676639c5","_state":{"style":{"default":{"zIndex":null}}},"content":{"default":{"children":[{"uid":"75409c39-15a2-4ebd-a5b6-1b17e19f99b6","isWwObject":true},{"uid":"a2ce0820-134e-4dff-bd73-37330c073944","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"ddd2e270-f431-45be-97aa-050b3c6f79c1":{"uid":"ddd2e270-f431-45be-97aa-050b3c6f79c1","_state":{"style":{}},"content":{"default":{"children":[{"uid":"810b7e20-aefa-46b3-af54-885e3580e9df","isWwObject":true},{"uid":"885b56a4-2a61-4d70-89ec-a4593f7d8549","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"def0dd34-fe7a-483b-b84c-d99ed9afcec0":{"uid":"def0dd34-fe7a-483b-b84c-d99ed9afcec0","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"12px 24px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"ee54f350-0ad4-4b23-9da4-2c0eb0957554","actions":{"46ca61b3-6e27-47d5-81b7-80caa455cb61":{"id":"46ca61b3-6e27-47d5-81b7-80caa455cb61","next":"7442e71b-8571-4dac-9a73-3293c601ef5b","type":"variable","varId":"af517f07-181d-4118-a343-8193085cf571","internal":false,"varValue":{"code":"// Get staff collection for mapping\r\nconst staffCollection = collections['c7aa9144-7d7f-4269-a7ba-af0ea93ff8a1']?.data ?? [];\r\n\r\n// Use only the current schedule selections (new draft = no merge needed)\r\nconst raw = collections['ee9baa8f-ba17-4f4b-b915-bb972423be13']?.data ?? [];\r\n\r\n// Create a lookup map of staff by ID\r\nconst staffMap = {};\r\nstaffCollection.forEach(staff => {\r\n  if (staff?.id) {\r\n    staffMap[staff.id] = staff;\r\n  }\r\n});\r\n\r\n// Normalize and deduplicate\r\nconst seen = new Set();\r\nconst normalizedAssignments = [];\r\n\r\nraw.forEach(item => {\r\n  const key = `${item.day_id}|${item.period_id}|${item.course_id}`;\r\n  if (!seen.has(key)) {\r\n    seen.add(key);\r\n\r\n    // Normalize staff_ids to full staff objects\r\n    let staff_ids = [];\r\n\r\n    if (Array.isArray(item.staff_ids)) {\r\n      staff_ids = item.staff_ids.map(staff =>\r\n        typeof staff === 'object' && staff !== null && staff.id\r\n          ? staffMap[staff.id] ?? staff\r\n          : staffMap[staff] ?? { id: staff }\r\n      );\r\n    } else if (Array.isArray(item.teacher_ids)) {\r\n      staff_ids = item.teacher_ids.map(id => staffMap[id] ?? { id });\r\n    }\r\n\r\n    normalizedAssignments.push({\r\n      day_id: String(item.day_id ?? '').trim(),\r\n      period_id: String(item.period_id ?? '').trim(),\r\n      course_id: String(item.course_id ?? '').trim(),\r\n      staff_ids,\r\n      room_id: item.room_id ?? null\r\n    });\r\n  }\r\n});\r\n\r\nreturn normalizedAssignments;\r\n","__wwtype":"js"}},"531323df-bc48-4972-84c2-24e405e9067a":{"id":"531323df-bc48-4972-84c2-24e405e9067a","next":"b8ff20b7-efa6-4890-8996-ed4eb54ed378","type":"variable","varId":"ed1819ac-5afa-44a3-b0d1-4637fb1d92ef","internal":false,"varValue":"planning"},"59bcffcb-eaab-45f7-b0b2-78f6ff462c63":{"id":"59bcffcb-eaab-45f7-b0b2-78f6ff462c63","args":{"params":[{"key":"_school_id","value":{"code":"collections['5a94bf43-aa17-443b-8075-2f49611c7f71']?.['data']?.[0]?.['id']","__wwtype":"f"}},{"key":"_semester_id","value":{"code":"context.component?.variables?.['03eb9f3c-5920-4bcf-84f1-2f8bf7976896-value']","__wwtype":"f"}},{"key":"_name","value":{"code":"context.component?.variables?.['13283cb0-d7fc-42bf-8cce-9ac432c16692-value']","__wwtype":"f"}},{"key":"_notes","value":{"code":"context.component?.variables?.['cf9c1d7b-a2e1-4b28-b9d3-92e0a6e742fd-value']","__wwtype":"f"}},{"key":"_created_by","value":{"code":"pluginVariables['1fa0dd68-5069-436c-9a7d-3b54c340f1fa']['user']?.['id']","__wwtype":"f"}}],"functionName":"scheduling_create_new_draft"},"next":"d3f18b73-d841-44d4-947b-720ac16a6333","type":"f9ef41c3-1c53-4857-855b-f2f6a40b7186-callPostgresFunction"},"7442e71b-8571-4dac-9a73-3293c601ef5b":{"id":"7442e71b-8571-4dac-9a73-3293c601ef5b","next":"531323df-bc48-4972-84c2-24e405e9067a","type":"reset-variables","varsId":["2c6bd0f7-f035-4093-8ec1-3c56184a6c4f"],"disabled":false},"80753446-1df2-4f2b-886a-5cff7be8b325":{"id":"80753446-1df2-4f2b-886a-5cff7be8b325","type":"execute-workflow:9ccf593d-9e4c-4e94-84cd-e58d82a7f2fa"},"934f4715-9b57-4c7d-8e66-3a5a29742a58":{"id":"934f4715-9b57-4c7d-8e66-3a5a29742a58","next":"46ca61b3-6e27-47d5-81b7-80caa455cb61","type":"variable","varId":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","usePath":false,"disabled":false,"internal":false,"varValue":{"code":"collections['13918157-039e-4c04-bc4e-95803a5de880']?.['data']?.[0]","__wwtype":"f"}},"b8ff20b7-efa6-4890-8996-ed4eb54ed378":{"id":"b8ff20b7-efa6-4890-8996-ed4eb54ed378","next":"80753446-1df2-4f2b-886a-5cff7be8b325","type":"_wwLocalMethod_popup.close"},"c486dd2d-eccd-442d-b77b-a9de287839d8":{"id":"c486dd2d-eccd-442d-b77b-a9de287839d8","next":"934f4715-9b57-4c7d-8e66-3a5a29742a58","type":"wait","value":3000},"d3f18b73-d841-44d4-947b-720ac16a6333":{"id":"d3f18b73-d841-44d4-947b-720ac16a6333","next":"c486dd2d-eccd-442d-b77b-a9de287839d8","type":"fetch-collection","collectionId":"13918157-039e-4c04-bc4e-95803a5de880"}},"trigger":"click","firstAction":"59bcffcb-eaab-45f7-b0b2-78f6ff462c63"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"db80cec7-2a20-4a99-aca2-74ac0f6aabd8","isWwObject":true},"rightIcon":{"uid":"563975e4-07c4-4068-b78f-664538b8caac","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","de":"<div>Speichern</div>","en":"<div>Save</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"e10e26eb-4cb8-4d36-b261-cdb402685bf4":{"uid":"e10e26eb-4cb8-4d36-b261-cdb402685bf4","_state":{"style":{"default":{"margin":"0"}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Draft Name"},"_ww-text_text":{"de":"<div>Entwurfsname\n</div>","en":"Draft Name"},"_ww-text_color":"#334155","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Name Label","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"e1e63596-c10e-4532-9f20-8fbba3915748":{"uid":"e1e63596-c10e-4532-9f20-8fbba3915748","_state":{"style":{"default":{"width":"24px","height":"auto","margin":"0 0 0px 0","transition":"all 0.2s ease"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[]},"content":{"default":{"icon":"lucide/x","color":"#94a3b8"},"_wwHover_default":{"color":"#64748b"}},"name":"Close Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"e275e659-dcad-4781-8af2-b68f19f379d9":{"uid":"e275e659-dcad-4781-8af2-b68f19f379d9","_state":{"style":{"default":{"width":"100%","display":"flex"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"e10e26eb-4cb8-4d36-b261-cdb402685bf4","isWwObject":true},{"uid":"13283cb0-d7fc-42bf-8cce-9ac432c16692","isWwObject":true},{"uid":"0633cc2f-8aa1-44f5-b3a7-8e2cf24bee52","isWwObject":true}],"_ww-layout_rowGap":"8px","_ww-layout_columnGap":"8px","_ww-layout_flexDirection":"column"}},"name":"Name Field Group","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"ed14230b-803b-4d45-90f3-e2a4d3db6d57":{"uid":"ed14230b-803b-4d45-90f3-e2a4d3db6d57","_state":{"style":{"default":{}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":"Choose how you want to proceed with your draft"},"_ww-text_text":{"de":"<div>Whlen Sie aus, wie Sie mit Ihrem Entwurf fortfahren mchten</div>","en":"Choose how you want to proceed with your draft"},"_ww-text_color":"#64748b","_ww-text_fontSize":"16px","_ww-text_textAlign":"center","_ww-text_fontWeight":"400"}},"name":"Draft Selection Subtitle","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"efd08839-c494-4e1f-a926-600520b79e4c":{"uid":"efd08839-c494-4e1f-a926-600520b79e4c","_state":{"style":{"default":{"width":"20px","height":"auto"}},"states":[],"interactions":[]},"content":{"default":{"icon":"lucide/calendar","color":"#475569"}},"name":"Semester Icon","wwObjectBaseId":"1b1e2173-9b78-42cc-a8ee-a6167caea340","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"f58ff2be-2ec7-4fb4-90c9-632cf333bf29":{"uid":"f58ff2be-2ec7-4fb4-90c9-632cf333bf29","_state":{"style":{"default":{"margin":"0"},"_wwHover_default":{}},"states":[],"interactions":[]},"content":{"default":{"tag":"p","text":{"en":{"code":"return context.item.data.description || 'No description available'","__wwtype":"js"}},"_ww-text_text":{"en":{"code":"return context.item.data?.['notes']","__wwtype":"js"}},"_ww-text_color":"#64748b","_ww-text_fontSize":"14px","_ww-text_lineHeight":"1.5"},"_wwHover_default":{}},"name":"Draft Description","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"f8de6f1e-9cf5-4355-afee-b28b4ea985f7":{"uid":"f8de6f1e-9cf5-4355-afee-b28b4ea985f7","_state":{"style":{"default":{}}},"content":{"tablet":{},"default":{"tag":"p","bgColor":"","shadows":"","fontStyle":"ww-font-style-text","textColor":"","globalStyle":{},"_ww-text_text":{"en":"<div>Edit Draft info</div>"},"transformation":"","_ww-text_nowrap":true,"_ww-text_ellipsis":false,"_ww-text_fontSize":"20px","_ww-text_sanitize":false,"_ww-text_fontWeight":500}},"name":"Text","wwObjectBaseId":"d7904e9d-fc9a-4d80-9e32-728e097879ad","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"fbc0cc5f-8f25-413d-9e1b-9205c032b2be":{"uid":"fbc0cc5f-8f25-413d-9e1b-9205c032b2be","_state":{"style":{"default":{"top":"16px","right":"16px","cursor":"pointer","margin":"0 0 0px 0","display":"block","position":"absolute"}},"states":[],"interactions":[{"id":"78cb3b49-3558-4bce-a942-be3c2e0e983a","name":"Close Popup","actions":{"action_ia_id":{"id":"action_ia_id","code":"await utilsFunctions.closePopup(context, null);","type":"custom-js"}},"trigger":"click","description":"Closes the popup without selection","firstAction":"action_ia_id"}]},"content":{"default":{"children":[{"uid":"e1e63596-c10e-4532-9f20-8fbba3915748","isWwObject":true}]}},"name":"Close Button Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"8f44d103-2fc4-4aa2-ac2f-2d67d958c484":{"uid":"8f44d103-2fc4-4aa2-ac2f-2d67d958c484","_state":{"style":{"default":{"width":"100%","border":"2px solid #e2e8f0","cursor":"pointer","display":"flex","padding":"14px 24px","customCss":{"align-items":"center","justify-content":"center"},"transition":"all 0.3s ease","borderRadius":"8px","backgroundColor":"#f8fafc"},"_wwHover_default":{"boxShadow":"0 4px 8px rgba(0, 0, 0, 0.05)","transform":"translateY(-2px)","backgroundColor":"#e2e8f0"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"9351c415-9afe-446c-9f4d-6d2f85aaa174","name":"Start New Draft","actions":{"9af654ed-10a7-46a9-89ea-dccefb67d755":{"id":"9af654ed-10a7-46a9-89ea-dccefb67d755","type":"variable","varId":"2c6bd0f7-f035-4093-8ec1-3c56184a6c4f","internal":true,"varValue":"new"}},"trigger":"click","description":"Closes popup and indicates starting new draft","firstAction":"9af654ed-10a7-46a9-89ea-dccefb67d755"}]},"content":{"default":{"text":{"en":"Start New Draft"},"disabled":false,"leftIcon":{"uid":"c6070bdb-dd46-43a8-8e86-db4c2e8d283c","isWwObject":true},"buttonType":"button","hasLeftIcon":true,"_ww-text_text":{"de":"<div>Neuen Entwurf starten</div>","en":"Start New Draft"},"_ww-text_color":"#334155","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"},"_wwHover_default":{}},"name":"Start New Draft Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"63f880ea-5252-4799-8eb0-39813f385b80":{"uid":"63f880ea-5252-4799-8eb0-39813f385b80","_state":{"style":{"default":{"width":"100%","cursor":"pointer","display":"flex","padding":"14px 24px","customCss":{"align-items":"center","justify-content":"center"},"transition":"all 0.3s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 8px rgba(59, 130, 246, 0.25)","transform":"translateY(-2px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"6ae0cf63-076f-48dc-9fdf-77eedb206fa1","name":"Load Previous Draft","actions":{"7ec58c12-623f-4120-9e26-d86825635e84":{"id":"7ec58c12-623f-4120-9e26-d86825635e84","next":null,"type":"variable","varId":"2c6bd0f7-f035-4093-8ec1-3c56184a6c4f","internal":true,"varValue":"load"}},"trigger":"click","description":"Closes popup and indicates loading previous draft","firstAction":"7ec58c12-623f-4120-9e26-d86825635e84"}]},"content":{"default":{"text":{"en":"Load Previous Draft"},"disabled":false,"leftIcon":{"uid":"84d1c7a6-bffc-49d0-9911-8e916e32cb74","isWwObject":true},"buttonType":"button","hasLeftIcon":true,"_ww-text_text":{"de":"<div>Vorherigen Entwurf laden</div>","en":"Load Previous Draft"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"},"_wwHover_default":{}},"name":"Load Previous Draft Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"068d65b4-6776-4009-a515-1703a5ac3665":{"uid":"068d65b4-6776-4009-a515-1703a5ac3665","_state":{"style":{"default":{"left":"-202px","border":"1px solid #8A8A8A","bottom":"-82px","cursor":"default","zIndex":100,"display":{"code":"wwFormulas.getKeyValue(context.component?.variables?.['26e57ccb-b8ac-4e7a-a105-43646740ca07'],\"id\")==context.item.data?.['id']","__wwtype":"f","defaultValue":"flex"},"padding":"12px","overflow":"visible","position":"absolute","boxShadow":"0px 0px 10px 1px #A6A6A6","borderRadius":"12px","backgroundColor":"#FFFFFF"}}},"content":{"default":{"children":[{"uid":"684cacbf-57f9-47e0-b80a-03709982a0a4","isWwObject":true}],"_ww-layout_rowGap":"10px","_ww-layout_columnGap":"10px","_ww-layout_flexDirection":"column"}},"name":"Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"5b30a123-d361-4503-89b9-6e06bc7c6e47":{"uid":"5b30a123-d361-4503-89b9-6e06bc7c6e47","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"8px 8px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"076d92bb-0796-4fb9-8e7e-679a9154b7c4","actions":{"0b4e2c7d-e06e-430c-96b5-9576bef6b2fc":{"id":"0b4e2c7d-e06e-430c-96b5-9576bef6b2fc","next":"9ad22925-8cb5-4c61-b8e6-bdbf2560a5da","type":"_wwLocalMethod_popup.close"},"11363ba1-36c4-441d-bb64-9b120f25c89e":{"id":"11363ba1-36c4-441d-bb64-9b120f25c89e","next":"73fac05e-8dbe-49b1-82ca-2ca2d3efba20","type":"variable","varId":"ed1819ac-5afa-44a3-b0d1-4637fb1d92ef","internal":false,"varValue":"planning"},"533351c6-5bdb-49ef-a686-17a1b795170e":{"id":"533351c6-5bdb-49ef-a686-17a1b795170e","next":"d63d2dd6-4198-4d1a-94f8-85ed99fcc50a","type":"wait","value":1000,"disabled":false},"635fc906-d1a0-42f2-bf61-39b448d53db0":{"id":"635fc906-d1a0-42f2-bf61-39b448d53db0","args":{"params":[{"key":"_draft_id","value":{"code":"variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.['id']","__wwtype":"f"}},{"key":"_schedule_data","value":{"code":"return variables['af517f07-181d-4118-a343-8193085cf571']","__wwtype":"js"}}],"functionName":"save_draft_to_db"},"next":"c8fd0451-8322-4b98-ba6d-fec45276d98d","type":"f9ef41c3-1c53-4857-855b-f2f6a40b7186-callPostgresFunction"},"73fac05e-8dbe-49b1-82ca-2ca2d3efba20":{"id":"73fac05e-8dbe-49b1-82ca-2ca2d3efba20","next":"a2b45da7-73ce-4fbb-98b5-602e5d529256","type":"variable","varId":"f85a1c6d-4075-424a-a54b-febff92b7ccf","internal":false,"varValue":false},"7e3868ea-e193-4c18-8d96-f78b29d4186e":{"id":"7e3868ea-e193-4c18-8d96-f78b29d4186e","args":{"params":[{"key":"_school_id","value":{"code":"collections['5a94bf43-aa17-443b-8075-2f49611c7f71']?.['data']?.[0]?.['id']","__wwtype":"f"}},{"key":"_semester_id","value":{"code":"context.item.data?.['semester_id']","__wwtype":"f"}},{"key":"_name","value":{"code":"context.local.data?.['form']?.['fields']?.['Input name duplicate']?.['value']","__wwtype":"f"}},{"key":"_notes","value":{"code":"\"null\"","__wwtype":"f"}},{"key":"_created_by","value":{"code":"pluginVariables['1fa0dd68-5069-436c-9a7d-3b54c340f1fa']['user']?.['id']","__wwtype":"f"}}],"functionName":"scheduling_create_new_draft"},"next":"8f80b123-27c8-40de-81c2-64f16c32317b","type":"f9ef41c3-1c53-4857-855b-f2f6a40b7186-callPostgresFunction"},"8f80b123-27c8-40de-81c2-64f16c32317b":{"id":"8f80b123-27c8-40de-81c2-64f16c32317b","next":"533351c6-5bdb-49ef-a686-17a1b795170e","type":"fetch-collections","collectionsId":["13918157-039e-4c04-bc4e-95803a5de880","06961c10-9632-4582-9f15-bb9ba8e53d61"]},"9ad22925-8cb5-4c61-b8e6-bdbf2560a5da":{"id":"9ad22925-8cb5-4c61-b8e6-bdbf2560a5da","next":"dc686def-8d5a-49af-9c3a-eb856dafc540","type":"variable","varId":"f85a1c6d-4075-424a-a54b-febff92b7ccf","internal":false,"varValue":true},"a2b45da7-73ce-4fbb-98b5-602e5d529256":{"id":"a2b45da7-73ce-4fbb-98b5-602e5d529256","type":"execute-workflow:9ccf593d-9e4c-4e94-84cd-e58d82a7f2fa"},"c8a35890-84bb-4ae6-bdd0-6d1fbe2fa2ec":{"id":"c8a35890-84bb-4ae6-bdd0-6d1fbe2fa2ec","next":"f1306403-d868-4328-92e0-1e8ea4286c13","type":"wait","value":500},"c8fd0451-8322-4b98-ba6d-fec45276d98d":{"id":"c8fd0451-8322-4b98-ba6d-fec45276d98d","next":"11363ba1-36c4-441d-bb64-9b120f25c89e","type":"reset-variables","varsId":["2c6bd0f7-f035-4093-8ec1-3c56184a6c4f","26e57ccb-b8ac-4e7a-a105-43646740ca07"],"disabled":false},"d63d2dd6-4198-4d1a-94f8-85ed99fcc50a":{"id":"d63d2dd6-4198-4d1a-94f8-85ed99fcc50a","next":"c8a35890-84bb-4ae6-bdd0-6d1fbe2fa2ec","type":"variable","varId":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","usePath":false,"disabled":false,"internal":false,"varValue":{"code":"collections['13918157-039e-4c04-bc4e-95803a5de880']?.['data']?.[0]","__wwtype":"f"}},"dc686def-8d5a-49af-9c3a-eb856dafc540":{"id":"dc686def-8d5a-49af-9c3a-eb856dafc540","code":"const date = new Date();\r\ndate.setSeconds(date.getSeconds() - 10);\r\nconsole.log(date);\r\n","next":"7e3868ea-e193-4c18-8d96-f78b29d4186e","type":"custom-js"},"f1306403-d868-4328-92e0-1e8ea4286c13":{"id":"f1306403-d868-4328-92e0-1e8ea4286c13","next":"635fc906-d1a0-42f2-bf61-39b448d53db0","type":"variable","varId":"af517f07-181d-4118-a343-8193085cf571","internal":false,"varValue":{"code":"const staffCollection = collections['c7aa9144-7d7f-4269-a7ba-af0ea93ff8a1']?.data ?? [];\r\nconst roomCollection = collections['44cd4f9d-216b-4f59-aa49-55fb859e5575']?.data ?? [];\r\nconst raw = wwFormulas.merge(\r\n  context.item.data?.['current_version'],\r\n  collections['ee9baa8f-ba17-4f4b-b915-bb972423be13']?.data\r\n) ?? [];\r\n\r\n// Create lookup maps\r\nconst staffMap = {};\r\nstaffCollection.forEach(staff => {\r\n  if (staff?.id) staffMap[staff.id] = staff;\r\n});\r\n\r\nconst roomMap = {};\r\nroomCollection.forEach(room => {\r\n  if (room?.id) roomMap[room.id] = room;\r\n});\r\n\r\n// Normalize and deduplicate\r\nconst seen = new Set();\r\nconst normalizedAssignments = [];\r\n\r\nraw.forEach(item => {\r\n  const key = `${item.day_id}|${item.period_id}|${item.course_id}`;\r\n  if (!seen.has(key)) {\r\n    seen.add(key);\r\n\r\n    // Normalize staff_ids to full staff objects\r\n    let staff_ids = [];\r\n\r\n    if (Array.isArray(item.staff_ids)) {\r\n      staff_ids = item.staff_ids.map(staff =>\r\n        typeof staff === 'object' && staff !== null && staff.id\r\n          ? staffMap[staff.id] ?? staff\r\n          : staffMap[staff] ?? { id: staff }\r\n      );\r\n    } else if (Array.isArray(item.teacher_ids)) {\r\n      staff_ids = item.teacher_ids.map(id => staffMap[id] ?? { id });\r\n    }\r\n\r\n    // Normalize room_id to full room object\r\n    let room_id = null;\r\n    const rawRoom = item.room_id;\r\n\r\n    if (Array.isArray(rawRoom)) {\r\n      const first = rawRoom[0];\r\n      room_id = typeof first === 'object' && first !== null\r\n        ? first\r\n        : roomMap[first] ?? null;\r\n    } else if (typeof rawRoom === 'object' && rawRoom !== null) {\r\n      room_id = rawRoom;\r\n    } else {\r\n      room_id = roomMap[rawRoom] ?? null;\r\n    }\r\n\r\n    normalizedAssignments.push({\r\n      day_id: String(item.day_id).trim(),\r\n      period_id: String(item.period_id).trim(),\r\n      course_id: String(item.course_id).trim(),\r\n      staff_ids,\r\n      room_id\r\n    });\r\n  }\r\n});\r\n\r\nreturn normalizedAssignments;\r\n","__wwtype":"js"}}},"trigger":"click","firstAction":"0b4e2c7d-e06e-430c-96b5-9576bef6b2fc"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"67afd335-d2d3-49ae-8fe3-a9dab45575de","isWwObject":true},"rightIcon":{"uid":"2d7c72c7-714b-4fb7-adb5-07fbc131ab67","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","en":"<div>Duplicate</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"d0d74739-ee34-4e08-89e3-c27efd155a72":{"uid":"d0d74739-ee34-4e08-89e3-c27efd155a72","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"8px 8px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#DC2626"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#F91010"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"e15d3e18-b830-494c-b0d5-22eb966f5bfe","actions":{"f6f4be1e-794f-48ba-b121-9f727222d165":{"id":"f6f4be1e-794f-48ba-b121-9f727222d165","type":"reset-variables","varsId":["d4def191-54aa-4a6b-b1d3-b5ead5da62e7"]}},"trigger":"click","firstAction":"f6f4be1e-794f-48ba-b121-9f727222d165"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"b03a15a9-df62-4273-82e9-5b5b01d2dce3","isWwObject":true},"rightIcon":{"uid":"222c7ada-cbe6-4489-856e-4a21ec93715c","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","en":"<div>Cancel</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"42b90b8e-8a7d-4b12-a8f9-fbfcf6e57214":{"uid":"42b90b8e-8a7d-4b12-a8f9-fbfcf6e57214","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"8px 8px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"d4a155d8-37fa-48d5-a7f7-8aca7ceb19dd","actions":{"07d81cff-9602-44ce-9282-1f160fe097e6":{"id":"07d81cff-9602-44ce-9282-1f160fe097e6","next":"725bdfc9-a6a7-4fad-a520-fe11739dbe42","type":"_wwLocalMethod_form.resetForm"},"64557176-87da-466b-9ca0-bad114dbfc18":{"id":"64557176-87da-466b-9ca0-bad114dbfc18","next":"07d81cff-9602-44ce-9282-1f160fe097e6","type":"fetch-collection","collectionId":"06961c10-9632-4582-9f15-bb9ba8e53d61"},"64dde378-0cd5-4014-b31e-3dd462f310e6":{"id":"64dde378-0cd5-4014-b31e-3dd462f310e6","args":{"params":[{"key":"p_draft_id","value":{"code":"context.item.data?.['id']","__wwtype":"f"}},{"key":"p_title","value":{"code":"context.local.data?.['form']?.['formData']?.['Input draft title']","__wwtype":"f"}},{"key":"p_notes","value":{"code":"context.local.data?.['form']?.['formData']?.['Input draft description']","__wwtype":"f"}}],"functionName":"update_schedule_draft_info"},"next":"64557176-87da-466b-9ca0-bad114dbfc18","type":"f9ef41c3-1c53-4857-855b-f2f6a40b7186-callPostgresFunction"},"725bdfc9-a6a7-4fad-a520-fe11739dbe42":{"id":"725bdfc9-a6a7-4fad-a520-fe11739dbe42","type":"reset-variables","varsId":["d4def191-54aa-4a6b-b1d3-b5ead5da62e7"]}},"trigger":"click","firstAction":"64dde378-0cd5-4014-b31e-3dd462f310e6"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"db4e32a5-405c-4a84-b739-11218ae68bc2","isWwObject":true},"rightIcon":{"uid":"b54e0b85-dcb0-4898-b96a-26cdb47b0fcf","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","en":"<div>Save</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"0a25cfbd-79b3-47cc-b0f9-1548a8bd4269":{"uid":"0a25cfbd-79b3-47cc-b0f9-1548a8bd4269","_state":{"style":{"default":{"align":"flex-end","width":"90px","border":"none","cursor":"pointer","margin":"10px 0 0 0","display":{"code":"context.component?.variables?.['2c6bd0f7-f035-4093-8ec1-3c56184a6c4f']==\"load\"","__wwtype":"f","defaultValue":true},"padding":"12px 24px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","maxHeight":"30px","minHeight":"30px","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"46aa01a5-bc70-4461-bcdd-dc7f0b8aefc3","actions":{"b1c9b12a-f6ef-4f86-ad73-0c5c39804822":{"id":"b1c9b12a-f6ef-4f86-ad73-0c5c39804822","type":"reset-variables","varsId":["2c6bd0f7-f035-4093-8ec1-3c56184a6c4f"]}},"trigger":"click","firstAction":"b1c9b12a-f6ef-4f86-ad73-0c5c39804822"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"cc3710ae-29ee-40a5-a13a-9f45845017c2","isWwObject":true},"rightIcon":{"uid":"81b9b6b4-3ab2-4455-9658-19fcb2a65f85","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","de":"<div>Zruck</div>","en":"<div>Back</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"6aa0fc66-090e-48d2-971b-da51087103c5":{"uid":"6aa0fc66-090e-48d2-971b-da51087103c5","_state":{"style":{"default":{"zIndex":null}}},"content":{"default":{"children":[{"uid":"66e4620e-107d-4c12-8fe5-824deb1f2393","isWwObject":true},{"uid":"068d65b4-6776-4009-a515-1703a5ac3665","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":null,"wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"6ccc16a6-fa2d-46a5-b004-7e87f28d00a5":{"uid":"6ccc16a6-fa2d-46a5-b004-7e87f28d00a5","_state":{"style":{"default":{"width":"320px"}}},"content":{"default":{"side":"bottom","align":"start","choices":{"code":"// Get all drafts\nconst drafts = collections['06961c10-9632-4582-9f15-bb9ba8e53d61'].data\n\n// Extract unique creator IDs from drafts\nconst creatorIds = [...new Set(drafts.map(draft => draft.created_by))]\n\n// Get staff details for these creators from staff collection\nconst staffCollection = collections['c7aa9144-7d7f-4269-a7ba-af0ea93ff8a1'].data\nreturn staffCollection.filter(staff => creatorIds.includes(staff.id))","__wwtype":"js","defaultValue":null},"offsetX":"0px","offsetY":"8px","disabled":false,"readonly":false,"required":false,"autoFocus":true,"fieldName":"","chipBorder":{"code":"[{\"label\":\"Option 1\",\"value\":\"opt1\"},{\"label\":\"Option 2\",\"value\":\"opt2\"}]","__wwtype":"f"},"optionIcon":null,"selectType":"single","showSearch":false,"validation":"","zIndexOpen":2,"boundOffset":"0px","chipBgColor":"#363636","chipPadding":"2px 8px","placeholder":{"de":"Ersteller*in","en":"Creator"},"searchWidth":"100%","chipFontSize":"14px","chipIconSize":"14px","initialState":"closed","mappingLabel":{"code":"context.mapping?.['full_name']","type":"f"},"mappingValue":{"code":"context.mapping?.['id']","type":"f"},"optionCursor":"pointer","searchBorder":false,"searchMargin":"0px 0px 8px 0px","chipFontColor":"white","chipIconColor":"white","closeOnSelect":true,"dropdownWidth":{"code":"context.local.data?.['select']?.['select']?.['utils']?.['triggerWidth']+'px'","__wwtype":"f"},"manualTrigger":false,"optionBgColor":"white","optionPadding":"8px","optionSpacing":"0px","searchBgColor":"#FAFAFA","searchPadding":"8px 12px","selectOnClick":true,"triggerBorder":false,"triggerMargin":"0px","chipFontWeight":null,"dropdownBorder":false,"emptyStateText":{"en":"No results found","fr":"Aucun rsultat trouv"},"optionFontSize":"14px","optionIconSize":"12px","triggerBgColor":"white","triggerPadding":"8px 8px","triggerShadows":"","dropdownBgColor":"#FFFFFF","dropdownPadding":"8px","dropdownShadows":"","initValueSingle":null,"mappingDisabled":{"code":"false","type":"f"},"optionFontColor":"black","optionIconColor":"black","searchBorderAll":"1px solid #A3A3A3","searchFontColor":"black","triggerIconOpen":null,"triggerIconSize":"16px","unselectOnClick":true,"chipBorderRadius":"4px","customValidation":false,"optionFontWeight":null,"searchFontWeight":null,"selectedFontSize":"14px","triggerBorderAll":"1px solid #B0B0B0","triggerIconClose":null,"triggerIconColor":"black","dropdownBorderAll":"1px solid #B0B0B0","emptyStatePadding":"0px","searchPlaceholder":{"en":"Search","fr":"Rechercher"},"selectedFontColor":"#333","selectedTextAlign":"left","emptyStateFontSize":"14px","optionBgColorHover":"#f5f5f5","optionBorderRadius":"4px","searchBorderRadius":"4px","selectedFontWeight":null,"closeOnClickOutside":true,"emptyStateFontColor":"black","emptyStateTextAlign":"center","placeholderFontSize":"14px","triggerBorderRadius":"4px","virtualScrollBuffer":600,"dropdownBorderRadius":"4px","emptyStateFontWeight":null,"optionBgColorFocused":"#f5f5f5","placeholderFontColor":"#333","placeholderTextAlign":"left","placeholderFontWeight":null,"allowScrollingWhenOpen":false,"searchPlaceholderColor":"#737373","virtualScrollMinItemSize":40}},"name":"select creator","wwObjectBaseId":"6145eb60-0af8-4e52-bcc6-dc0f6743654e","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"e4f8e64e-7688-4a18-b9ba-764efe0a4d29":{"uid":"e4f8e64e-7688-4a18-b9ba-764efe0a4d29","_state":{"style":{"default":{"width":"100%","display":{"code":"context.component?.variables?.['2c6bd0f7-f035-4093-8ec1-3c56184a6c4f']==\"new\"","__wwtype":"f","defaultValue":"flex"},"maxWidth":"940px"}}},"content":{"default":{"children":[{"uid":"f2e5a7fe-55ea-4208-8fb4-f27c94b06fe8","isWwObject":true}],"_ww-layout_flexDirection":"column"}},"name":"Container new draft","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"b77a8f9b-e942-4ab7-904d-74af9ddeab1e":{"uid":"b77a8f9b-e942-4ab7-904d-74af9ddeab1e","_state":{"style":{"default":{"border":"none","cursor":"pointer","padding":"8px 8px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#DC2626"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#F91010"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"e15d3e18-b830-494c-b0d5-22eb966f5bfe","actions":{"f6f4be1e-794f-48ba-b121-9f727222d165":{"id":"f6f4be1e-794f-48ba-b121-9f727222d165","type":"reset-variables","varsId":["26e57ccb-b8ac-4e7a-a105-43646740ca07"]}},"trigger":"click","firstAction":"f6f4be1e-794f-48ba-b121-9f727222d165"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"43cb4ab7-e582-484f-9ea3-7e71862f6e15","isWwObject":true},"rightIcon":{"uid":"bee60931-1838-4c5b-9258-fc3525cb9c5b","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","en":"<div>Cancel</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"f2e5a7fe-55ea-4208-8fb4-f27c94b06fe8":{"uid":"f2e5a7fe-55ea-4208-8fb4-f27c94b06fe8","_state":{"style":{"default":{"width":"100%","display":"flex","padding":"40px","maxWidth":"600px","boxShadow":"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05)","transition":"all 0.3s ease","borderRadius":"16px","backgroundColor":"#ffffff","animationDuration":"800ms","animationFillMode":"both","animationKeyframes":"@keyframes keyframe-edition-animation { 0% {opacity:0;transform:translateY(20px);} 100% {opacity:1;transform:translateY(0);}}","animationIterationCount":"1","animationTimingFunction":"cubic-bezier(0.4, 0, 0.2, 1)"}},"states":[],"interactions":[]},"content":{"default":{"children":[{"uid":"3d95877b-bd27-4205-88d0-147f28ebef41","isWwObject":true},{"uid":"a29cdf6d-abf6-4bfb-9bfa-2a5c1f720f77","isWwObject":true},{"uid":"2b13a669-6651-4839-b6c8-3dbbf765df84","isWwObject":true}],"_ww-layout_rowGap":"32px","_ww-layout_columnGap":"32px","_ww-layout_flexDirection":"column"}},"name":"Form Container","wwObjectBaseId":"b783dc65-d528-4f74-8c14-e27c934c39b1","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"03eb9f3c-5920-4bcf-84f1-2f8bf7976896":{"uid":"03eb9f3c-5920-4bcf-84f1-2f8bf7976896","_state":{"style":{"default":{"width":"100%"}},"states":[],"interactions":[],"dynamicConfiguration":{"content":{"choices":[{"key":"label","type":"Text"},{"key":"value","type":"Text"}]}}},"content":{"default":{"side":"bottom","align":"start","choices":{"code":"collections['68252bbc-8e5e-4c1a-ac8b-9ae87654e17b']?.['data']","__wwtype":"f","defaultValue":[{"label":"Fall 2023","value":"fall2023"},{"label":"Spring 2024","value":"spring2024"},{"label":"Summer 2024","value":"summer2024"},{"label":"Fall 2024","value":"fall2024"}]},"offsetX":"0px","offsetY":"8px","disabled":false,"readonly":false,"required":false,"autoFocus":true,"fieldName":"","chipBorder":{"code":"[{\"label\":\"Option 1\",\"value\":\"opt1\"},{\"label\":\"Option 2\",\"value\":\"opt2\"}]","__wwtype":"f"},"optionIcon":null,"selectType":"single","showSearch":false,"validation":"","zIndexOpen":2,"boundOffset":"0px","chipBgColor":"#363636","chipPadding":"2px 8px","placeholder":{"de":"Halbjahr auswhlen","en":"Select a semester"},"searchWidth":"100%","chipFontSize":"14px","chipIconSize":"14px","initialState":"closed","mappingLabel":{"code":"context.mapping?.['name']+\" - \"+pluginFormulas['832d6f7a-42c3-43f1-a3ce-9a678272f811']['formatDate'](context.mapping?.['start_date'],\"YY\")+\"/\"+pluginFormulas['832d6f7a-42c3-43f1-a3ce-9a678272f811']['formatDate'](context.mapping?.['end_date'],\"YYYY\")","type":"f"},"mappingValue":{"code":"context.mapping?.['id']","type":"f"},"optionCursor":"pointer","searchBorder":false,"searchMargin":"0px 0px 8px 0px","chipFontColor":"white","chipIconColor":"white","closeOnSelect":true,"dropdownWidth":{"code":"context.local.data?.['select']?.['select']?.['utils']?.['triggerWidth']+'px'","__wwtype":"f"},"manualTrigger":false,"optionPadding":"12px 16px","optionSpacing":"0px","searchBgColor":"#FAFAFA","searchPadding":"8px 12px","selectOnClick":true,"triggerBorder":false,"triggerHeight":"48px","triggerMargin":"0px","chipFontWeight":null,"dropdownBorder":false,"emptyStateText":{"en":"No results found","fr":"Aucun rsultat trouv"},"optionFontSize":"16px","optionIconSize":"12px","triggerBgColor":"#ffffff","triggerPadding":"0 16px","triggerShadows":"","dropdownBgColor":"#ffffff","dropdownPadding":"8px","dropdownShadows":"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)","initValueSingle":{"code":"","__wwtype":"js"},"mappingDisabled":{"code":"false","type":"f"},"optionFontColor":"#334155","optionIconColor":"black","searchBorderAll":"1px solid #A3A3A3","searchFontColor":"black","triggerIconOpen":null,"triggerIconSize":"16px","unselectOnClick":false,"chipBorderRadius":"4px","customValidation":false,"optionFontWeight":400,"searchFontWeight":null,"selectedFontSize":"16px","triggerBorderAll":"1px solid #cbd5e1","triggerIconClose":null,"triggerIconColor":"black","dropdownBorderAll":"1px solid #B0B0B0","emptyStatePadding":"0px","searchPlaceholder":{"en":"Search","fr":"Rechercher"},"selectedFontColor":"#334155","selectedTextAlign":"left","emptyStateFontSize":"14px","optionBgColorHover":"#f1f5f9","optionBorderRadius":"4px","searchBorderRadius":"4px","selectedFontFamily":"inherit","selectedFontWeight":400,"closeOnClickOutside":true,"emptyStateFontColor":"black","emptyStateTextAlign":"center","placeholderFontSize":"14px","triggerBorderRadius":"8px","virtualScrollBuffer":600,"dropdownBorderRadius":"8px","emptyStateFontWeight":null,"optionBgColorFocused":"#f5f5f5","placeholderFontColor":"#94a3b8","placeholderTextAlign":"left","placeholderFontWeight":null,"allowScrollingWhenOpen":false,"searchPlaceholderColor":"#737373","virtualScrollMinItemSize":40}},"name":"Semester Select","wwObjectBaseId":"6145eb60-0af8-4e52-bcc6-dc0f6743654e","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"},"59886854-a759-41d8-a062-6bff1879655d":{"uid":"59886854-a759-41d8-a062-6bff1879655d","_state":{"style":{"default":{"align":"flex-end","border":"none","cursor":"pointer","zIndex":null,"padding":"5px","boxShadow":"0 2px 4px rgba(0,0,0,0.1)","transition":"all 0.2s ease","borderRadius":"8px","backgroundColor":"#3b82f6"},"_wwHover_default":{"boxShadow":"0 4px 6px rgba(0,0,0,0.1)","transform":"translateY(-1px)","backgroundColor":"#2563eb"}},"states":[{"id":"_wwHover","label":"hover"}],"interactions":[{"id":"fe0c4439-85fe-4384-ac20-081584f43feb","icon":"cursor","name":"load draft","index":0,"actions":{"05632af2-2182-42ce-9db9-437b0869633c":{"id":"05632af2-2182-42ce-9db9-437b0869633c","next":"c66240b6-acbe-4835-b29c-92248f1dd305","type":"variable","varId":"f85a1c6d-4075-424a-a54b-febff92b7ccf","internal":false,"varValue":false},"40254813-0357-41f6-9d55-299488404c40":{"id":"40254813-0357-41f6-9d55-299488404c40","next":"d8c6d4a5-8590-42c0-9900-d2402385a428","type":"_wwLocalMethod_popup.close","disabled":false},"4c953f1c-ff95-4c43-8705-52112c4fda26":{"id":"4c953f1c-ff95-4c43-8705-52112c4fda26","next":"05632af2-2182-42ce-9db9-437b0869633c","type":"reset-variables","varsId":["2c6bd0f7-f035-4093-8ec1-3c56184a6c4f"],"disabled":false},"545f4b82-6982-49e4-8b6e-583eb90f4597":{"id":"545f4b82-6982-49e4-8b6e-583eb90f4597","next":"c0b8bcee-263f-4db1-ad78-5e242888123a","type":"variable","varId":"af517f07-181d-4118-a343-8193085cf571","internal":false,"varValue":{"code":"// -- Input Data\r\nconst draft = context.item.data?.['current_version'] ?? [];\r\nconst scheduleCollection = collections['ee9baa8f-ba17-4f4b-b915-bb972423be13']?.data ?? [];\r\n\r\n// -- Utility: Create safe composite key\r\nfunction generateKey(item) {\r\n  const day_id = item.day_id ?? 'NO_DAY';\r\n  const period_id = item.period_id ?? 'NO_PERIOD';\r\n  const rawId = item.course_id ?? item.class_id ?? 'NO_ID';\r\n  const normalizedId = typeof rawId === 'string' ? rawId.toLowerCase() : rawId;\r\n  return `${day_id}|${period_id}|${normalizedId}`;\r\n}\r\n\r\n// -- Normalize draft into a map (composite key)\r\nconst draftMap = {};\r\ndraft.forEach(item => {\r\n  const key = generateKey(item);\r\n  draftMap[key] = {\r\n    ...item,\r\n    isDraft: true,\r\n    currentlyScheduled: true,\r\n    staff_ids: item.staff_ids ?? [],\r\n    teacher_names: item.teacher_names ?? [],\r\n    scheduled_room_name: item.scheduled_room_name ?? '',\r\n    room_name: item.room_name ?? '',\r\n    class_name: item.class_name ?? '',\r\n    course_name: item.course_name ?? '',\r\n    day_name_de: item.day_name_de ?? '',\r\n    day_name_en: item.day_name_en ?? '',\r\n    block_number: item.block_number ?? null,\r\n    display_cell: item.display_cell ?? '',\r\n    subject_name: item.subject_name ?? '',\r\n    subject_color: item.subject_color ?? null,\r\n    subject_icon_id: item.subject_icon_id ?? null,\r\n    class_grade_level: item.class_grade_level ?? null,\r\n  };\r\n});\r\n\r\n// -- Merge in published entries ONLY if not in draft\r\nscheduleCollection.forEach(item => {\r\n  const key = generateKey(item);\r\n  if (!draftMap[key]) {\r\n    draftMap[key] = {\r\n      ...item,\r\n      isDraft: false,\r\n      currentlyScheduled: true,\r\n      staff_ids: item.teacher_ids ?? [],\r\n      teacher_names: item.teacher_names ?? [],\r\n      scheduled_room_name: item.scheduled_room_name ?? '',\r\n      room_name: item.room_name ?? '',\r\n      class_name: item.class_name ?? '',\r\n      course_name: item.course_name ?? '',\r\n      day_name_de: item.day_name_de ?? '',\r\n      day_name_en: item.day_name_en ?? '',\r\n      block_number: item.block_number ?? null,\r\n      display_cell: item.display_cell ?? '',\r\n      subject_name: item.subject_name ?? '',\r\n      subject_color: item.subject_color ?? null,\r\n      subject_icon_id: item.subject_icon_id ?? null,\r\n      class_grade_level: item.class_grade_level ?? null,\r\n    };\r\n  }\r\n});\r\n\r\n// -- Final array\r\nconst normalizedAssignments = Object.values(draftMap);\r\n\r\nreturn normalizedAssignments;\r\n","__wwtype":"js"}},"b8669f5a-b4f5-4bec-bcfb-f5acfd383bb4":{"id":"b8669f5a-b4f5-4bec-bcfb-f5acfd383bb4","next":"545f4b82-6982-49e4-8b6e-583eb90f4597","type":"variable","varId":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","internal":false,"varValue":{"code":"context.item.data","__wwtype":"f"}},"c0b8bcee-263f-4db1-ad78-5e242888123a":{"id":"c0b8bcee-263f-4db1-ad78-5e242888123a","next":"4c953f1c-ff95-4c43-8705-52112c4fda26","type":"variable","varId":"ed1819ac-5afa-44a3-b0d1-4637fb1d92ef","internal":false,"varValue":"planning"},"c66240b6-acbe-4835-b29c-92248f1dd305":{"id":"c66240b6-acbe-4835-b29c-92248f1dd305","type":"execute-workflow:9ccf593d-9e4c-4e94-84cd-e58d82a7f2fa"},"d8c6d4a5-8590-42c0-9900-d2402385a428":{"id":"d8c6d4a5-8590-42c0-9900-d2402385a428","next":"b8669f5a-b4f5-4bec-bcfb-f5acfd383bb4","type":"variable","varId":"f85a1c6d-4075-424a-a54b-febff92b7ccf","internal":false,"varValue":true}},"trigger":"click","isSearched":false,"description":"On click","firstAction":"40254813-0357-41f6-9d55-299488404c40"}]},"content":{"default":{"text":"New text","disabled":false,"leftIcon":{"uid":"0b6ad324-5ff6-49ef-95b9-211369807dfe","isWwObject":true},"rightIcon":{"uid":"9ea101f5-81f6-4b36-a413-911dbf104434","isWwObject":true},"buttonType":"button","hasLeftIcon":false,"hasRightIcon":false,"_ww-text_text":{"0":"N","1":"e","2":"w","3":" ","4":"t","5":"e","6":"x","7":"t","de":"<div>Laden mit schedule data</div>","en":"<div>Load</div>"},"_ww-text_color":"#ffffff","_ww-text_fontSize":"16px","_ww-text_fontWeight":"500"}},"name":"Button","wwObjectBaseId":"59dca300-db78-42e4-a7a6-0cbf22d3cc82","libraryComponentBaseId":null,"parentLibraryComponentId":"1d81391f-2e84-4504-b916-973a6d719b8a"}},"collections":[{"id":"6e82c174-d8cb-448a-ab8a-455fd77084ce","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Subject","displayBy":null,"lastSyncDate":null,"config":{"table":"subjects","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-21T18:10:47.445Z","updatedAt":"2025-07-29T17:09:12.584Z","data":{}},{"id":"18b475b5-a69a-4000-8dfe-1cb5558734f5","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"View School days","displayBy":null,"lastSyncDate":null,"config":{"table":"vw_school_days","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["day_id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[]},"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-24T10:50:19.680Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"ee9baa8f-ba17-4f4b-b915-bb972423be13","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Schedules","displayBy":null,"lastSyncDate":null,"config":{"table":"vw_course_schedules_detailed","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":"id,\ncourse_id,\nday_of_week,\nstart_time,\nend_time,\nstart_date,\nend_date,\nroom_id,\nschool_id,\ncreated_at,\nteacher_ids,\nvalid_from,\nvalid_until,\nteacher_info:teacher_id (\n  profile_info_staff (\n    first_name,\n    last_name\n  )\n)\n"},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[{"field":"is_archived","value":false,"operator":"$eq","isEmptyIgnored":false}]},"sort":[{"key":"created_at","direction":"DESC"}],"isSyncing":false,"needSync":false,"fields":{},"folder":null,"description":null,"createdAt":"2025-04-22T17:31:46.698Z","updatedAt":"2025-08-19T15:13:22.731Z","data":{}},{"id":"cc215fad-c61a-4270-9a1b-b50c3b1bfcc9","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Periods","displayBy":null,"lastSyncDate":null,"config":{"table":"schedule_periods","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-12T08:28:01.998Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"8e251521-1e10-45bb-8272-628c64dac5bb","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Course overview","displayBy":null,"lastSyncDate":null,"config":{"table":"w_course_summary","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["course_id","subject_id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Course views/","description":null,"createdAt":"2025-05-21T14:16:52.153Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"9750c008-5b3f-4bd0-8402-d792ff4b5b3c","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Days of week","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_days","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":null,"description":null,"createdAt":"2025-05-16T13:50:11.604Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"fa8f3ff8-d844-4b42-bd94-bd420ee34fc7","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Staff profile detailed","displayBy":null,"lastSyncDate":null,"config":{"table":"vw_staff","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Profile info/","description":null,"createdAt":"2025-06-27T17:57:40.538Z","updatedAt":"2025-07-08T18:30:14.782Z","data":{}},{"id":"96d96747-58c8-4dec-a084-0d22a00f645c","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Courses","displayBy":null,"lastSyncDate":null,"config":{"table":"course_list","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[]},"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Course views/","description":null,"createdAt":"2025-04-16T07:53:39.631Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"06961c10-9632-4582-9f15-bb9ba8e53d61","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Drafts","displayBy":null,"lastSyncDate":null,"config":{"table":"schedule_drafts","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Scheduling/","description":null,"createdAt":"2025-06-19T16:21:23.986Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"5a94bf43-aa17-443b-8075-2f49611c7f71","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"School","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_schools","dataFields":["id","name","timezone","language","year_groups","Logo","principal_id","email","phone","fax","address_street","address_number","address_postal_code","address_city","address_country","floor_options","building_options","allow_custom_course_times"],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[]},"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-04-22T14:48:14.746Z","updatedAt":"2025-07-14T06:52:54.579Z","data":{}},{"id":"44cd4f9d-216b-4f59-aa49-55fb859e5575","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Rooms","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_rooms","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-28T07:26:46.024Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"73612d4e-203c-46df-a227-655e3a3a9c70","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"School days","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_school_days","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["school_id","day_id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[]},"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-23T16:15:42.664Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"b8d0c0e2-1e1a-49c1-b2e7-6d468ab46eb2","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Classes","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_classes","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":"id, school_id"},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[]},"sort":[{"key":"name","direction":"ASC"}],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-06T11:39:06.477Z","updatedAt":"2025-07-14T06:52:10.314Z","data":{}},{"id":"5f37592e-5054-4720-8e8e-9b076df2b07b","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Classrooms","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_rooms","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Structure/","description":null,"createdAt":"2025-05-12T08:25:02.462Z","updatedAt":"2025-07-14T06:52:04.225Z","data":{}},{"id":"c7aa9144-7d7f-4269-a7ba-af0ea93ff8a1","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Teacher profiles","displayBy":null,"lastSyncDate":null,"config":{"table":"vw_staff","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[{"link":"$or","conditions":[{"field":"role_id","value":"6b4ffe63-6384-497b-b40c-473af51dc26d","operator":"$eq"},{"field":"role_id","value":"8b8123fd-ee8e-429d-b6c6-579f82e7c306","operator":"$eq"}]}]},"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Profile info/","description":null,"createdAt":"2025-05-15T15:06:22.973Z","updatedAt":"2025-08-19T15:29:22.317Z","data":{}},{"id":"68252bbc-8e5e-4c1a-ac8b-9ae87654e17b","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Semesters","displayBy":null,"lastSyncDate":null,"config":{"table":"structure_school_semesters","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":[],"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Scheduling/School years/","description":null,"createdAt":"2025-06-11T07:57:07.696Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}},{"id":"13918157-039e-4c04-bc4e-95803a5de880","designId":"d93a1b88-4f83-4782-a4d6-6bc9db5c53b3","settingsId":"1380fd5e-642d-426e-880f-d81769a573e6","pluginId":"f9ef41c3-1c53-4857-855b-f2f6a40b7186","type":"single","name":"Last draft created","displayBy":null,"lastSyncDate":null,"config":{"table":"schedule_drafts","dataFields":[],"fieldsMode":"guided","isAutoFetch":true,"primaryData":["id"],"isPersistentOnNav":true,"dataFieldsAdvanced":""},"error":null,"limit":null,"mode":"dynamic","filter":{"link":"$and","conditions":[{"field":"created_by","value":{"code":"pluginVariables['1fa0dd68-5069-436c-9a7d-3b54c340f1fa']['user']?.['id']","__wwtype":"f"},"operator":"$eq"},{"field":"created_at","value":{"code":"return new Date(Date.now() - 10 * 1000).toISOString();\r\n","__wwtype":"js"},"operator":"$gt"},{"link":"$or","conditions":[]}]},"sort":[],"isSyncing":false,"needSync":false,"fields":{},"folder":"Scheduling/","description":null,"createdAt":"2025-06-24T17:17:45.363Z","updatedAt":"2025-07-05T15:40:36.770Z","data":{}}],"variables":[{"id":"2d4635aa-bcc2-43e2-af7f-03fd782299c4","type":"object","name":"draftData","defaultValue":null,"isLocalStorage":true,"isPersistentOnNav":true},{"id":"4d1b4e2c-7a4b-473e-8556-5d559123999f","type":"array","name":"previous snapshots","defaultValue":[],"isLocalStorage":false,"isPersistentOnNav":true},{"id":"48b3a5ce-9774-47ff-bf75-5b57918a9334","type":"array","name":"Grade","defaultValue":[],"isLocalStorage":false,"isPersistentOnNav":false},{"id":"81cf6332-a7bc-4d6a-94cf-502db37bf689","type":"object","name":"draftEditorState","defaultValue":{},"isLocalStorage":false,"isPersistentOnNav":true},{"id":"a7727850-d6e3-4253-9b22-2e9ecc1209ce","type":"object","name":"Edit course","defaultValue":{},"isLocalStorage":false,"isPersistentOnNav":false},{"id":"af517f07-181d-4118-a343-8193085cf571","type":"array","name":"draft_schedule","defaultValue":[],"isLocalStorage":false,"isPersistentOnNav":false},{"id":"5c5431d0-9891-49de-bfd1-67d2dd7a8143","type":"array","name":"draft_schedule_session_history","defaultValue":[],"isLocalStorage":false,"isPersistentOnNav":false},{"id":"b99a8b46-70c2-4f04-ac6f-90044620c4a5","type":"string","name":"zoom in ","defaultValue":"","isLocalStorage":false,"isPersistentOnNav":false},{"id":"ed1819ac-5afa-44a3-b0d1-4637fb1d92ef","type":"string","name":"planningViewMode","defaultValue":"live","isLocalStorage":false,"isPersistentOnNav":true},{"id":"f85a1c6d-4075-424a-a54b-febff92b7ccf","type":"boolean","name":"Publishing","defaultValue":false,"isLocalStorage":false,"isPersistentOnNav":false},{"id":"086e7c46-6f07-4281-9505-3a90dd20740a","type":"boolean","name":"trigger_autosave","defaultValue":false,"isLocalStorage":false,"isPersistentOnNav":false},{"id":"8f893bde-67e4-4938-8774-f988900ea044","type":"string","name":"Draft test text","defaultValue":"","isLocalStorage":false,"isPersistentOnNav":false},{"id":"d8e368cc-bd12-4783-bea6-c382e9577c43","type":"object","name":"draft test event","defaultValue":{},"isLocalStorage":false,"isPersistentOnNav":false}],"workflows":[{"id":"9ccf593d-9e4c-4e94-84cd-e58d82a7f2fa","parameters":[],"actions":{"049e1cd8-b273-4e62-9652-a004fb865002":{"id":"049e1cd8-b273-4e62-9652-a004fb865002","type":"break-loop","value":{"code":"return variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef']==\"live\"","__wwtype":"js"}},"0672f840-a91c-444e-97a7-e10c49754dff":{"id":"0672f840-a91c-444e-97a7-e10c49754dff","next":"049e1cd8-b273-4e62-9652-a004fb865002","type":"wait","value":30000},"08bdcb3c-d02f-4633-9d75-f0593effaf9a":{"id":"08bdcb3c-d02f-4633-9d75-f0593effaf9a","type":"variable","varId":"086e7c46-6f07-4281-9505-3a90dd20740a","internal":false,"varValue":false},"3d823362-7425-4e5c-bf71-be5a30745c26":{"id":"3d823362-7425-4e5c-bf71-be5a30745c26","next":"fd730004-6c79-490c-a557-8041772cb213","type":"variable","varId":"086e7c46-6f07-4281-9505-3a90dd20740a","internal":false,"varValue":true},"4fa68f66-4401-41a5-b908-0b3c889e15c0":{"id":"4fa68f66-4401-41a5-b908-0b3c889e15c0","next":"08bdcb3c-d02f-4633-9d75-f0593effaf9a","type":"fetch-collection","collectionId":"06961c10-9632-4582-9f15-bb9ba8e53d61"},"6b2b9f39-cc00-4577-ad73-0b4f99c4645e":{"id":"6b2b9f39-cc00-4577-ad73-0b4f99c4645e","code":"return null","type":"custom-js"},"76c579df-9921-492d-89b0-bfedb5dbf023":{"id":"76c579df-9921-492d-89b0-bfedb5dbf023","next":"0672f840-a91c-444e-97a7-e10c49754dff","type":"if","value":{"code":"const state = variables['81cf6332-a7bc-4d6a-94cf-502db37bf689'];\r\nconst planningMode = variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef'];\r\nconst draftId = variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.id;\r\n\r\nconst lastSaved = new Date(state?.last_saved_at || 0);\r\nconst now = new Date();\r\nconst diff = (now - lastSaved) / 1000;\r\n\r\nconst shouldAutosave =\r\n  planningMode === 'planning' &&\r\n  draftId &&\r\n  state?.is_dirty &&\r\n  (state.step_counter >= 5 || diff >= 120);\r\n\r\nreturn shouldAutosave;","__wwtype":"js"},"branches":[{"id":"3d823362-7425-4e5c-bf71-be5a30745c26","value":true},{"id":"6b2b9f39-cc00-4577-ad73-0b4f99c4645e","value":false}]},"e356fcd6-5038-46c2-95f0-a95cc416b008":{"id":"e356fcd6-5038-46c2-95f0-a95cc416b008","loop":"76c579df-9921-492d-89b0-bfedb5dbf023","type":"while-loop","value":{"code":"const planningMode = variables['ed1819ac-5afa-44a3-b0d1-4637fb1d92ef'];\r\nconst draftId = variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.id;\r\n\r\n// Loop only while we're in planning mode AND there's a draft\r\nreturn planningMode === 'planning' && !!draftId;","__wwtype":"js"}},"ef0a9b9f-2e30-4169-a0e4-0b8bdb7e1653":{"id":"ef0a9b9f-2e30-4169-a0e4-0b8bdb7e1653","code":"const state = variables['81cf6332-a7bc-4d6a-94cf-502db37bf689'] || {};\r\nstate.is_dirty = false;\r\nstate.step_counter = 0;\r\nstate.last_saved_at = new Date().toISOString();\r\nvariables['81cf6332-a7bc-4d6a-94cf-502db37bf689'] = state;\r\n\r\nconsole.log(\" Autosave complete  state reset\", state);","next":"f3b1718d-c7d2-4e91-8015-52acccd61ed0","type":"custom-js"},"f3b1718d-c7d2-4e91-8015-52acccd61ed0":{"id":"f3b1718d-c7d2-4e91-8015-52acccd61ed0","next":"4fa68f66-4401-41a5-b908-0b3c889e15c0","type":"wait","value":1000},"fd730004-6c79-490c-a557-8041772cb213":{"id":"fd730004-6c79-490c-a557-8041772cb213","args":{"params":[{"key":"_draft_id","value":{"code":"variables['2d4635aa-bcc2-43e2-af7f-03fd782299c4']?.['id']","__wwtype":"f"}},{"key":"_schedule_data","value":{"code":"return variables['af517f07-181d-4118-a343-8193085cf571']","__wwtype":"js"}}],"functionName":"save_draft_to_db"},"next":"ef0a9b9f-2e30-4169-a0e4-0b8bdb7e1653","type":"f9ef41c3-1c53-4857-855b-f2f6a40b7186-callPostgresFunction"}},"firstAction":"e356fcd6-5038-46c2-95f0-a95cc416b008","firstErrorAction":null},{"id":"4915a095-ebe9-4d51-87ae-43cf47906749","parameters":[],"actions":{"3dc149c5-bae9-4785-b6e1-a74fc81a50ca":{"id":"3dc149c5-bae9-4785-b6e1-a74fc81a50ca","type":"fetch-collections","collectionsId":["9750c008-5b3f-4bd0-8402-d792ff4b5b3c","18b475b5-a69a-4000-8dfe-1cb5558734f5","ee9baa8f-ba17-4f4b-b915-bb972423be13","cc215fad-c61a-4270-9a1b-b50c3b1bfcc9","8e251521-1e10-45bb-8272-628c64dac5bb","96d96747-58c8-4dec-a084-0d22a00f645c","5f37592e-5054-4720-8e8e-9b076df2b07b","5a94bf43-aa17-443b-8075-2f49611c7f71","c7aa9144-7d7f-4269-a7ba-af0ea93ff8a1","73612d4e-203c-46df-a227-655e3a3a9c70","44cd4f9d-216b-4f59-aa49-55fb859e5575","6e82c174-d8cb-448a-ab8a-455fd77084ce","68252bbc-8e5e-4c1a-ac8b-9ae87654e17b","06961c10-9632-4582-9f15-bb9ba8e53d61","fa8f3ff8-d844-4b42-bd94-bd420ee34fc7","b8d0c0e2-1e1a-49c1-b2e7-6d468ab46eb2"]}},"firstAction":"3dc149c5-bae9-4785-b6e1-a74fc81a50ca","firstErrorAction":null}],"formulas":[],"libraryComponents":[{"id":"1d81391f-2e84-4504-b916-973a6d719b8a","configuration":{},"inner":{"variables":{"26e57ccb-b8ac-4e7a-a105-43646740ca07":{"id":"26e57ccb-b8ac-4e7a-a105-43646740ca07","name":"duplicate draft","type":"object","defaultValue":{}},"2c6bd0f7-f035-4093-8ec1-3c56184a6c4f":{"id":"2c6bd0f7-f035-4093-8ec1-3c56184a6c4f","name":"New or load draft","type":"string"},"d4def191-54aa-4a6b-b1d3-b5ead5da62e7":{"id":"d4def191-54aa-4a6b-b1d3-b5ead5da62e7","name":"edit draft","type":"object","defaultValue":{}}}},"rootElementId":"d28741b6-e8e0-4493-9e8a-2d2e15f8691e","type":"modal"}]}